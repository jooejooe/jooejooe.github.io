<!doctype html><html lang=zh-CN data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.121.2"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16.icon><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32.icon><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="开源版tailscale，headscale搭建"><meta itemprop=description content="记录轨迹。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="/imgs/hugo_next_avatar.png"><meta itemprop=keywords content="headscale"><meta property="og:type" content="article"><meta property="og:title" content="开源版tailscale，headscale搭建"><meta property="og:description" content="记录轨迹。"><meta property="og:image" content="/imgs/hugo_next_avatar.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="/post/%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/%E5%BC%80%E6%BA%90%E7%89%88tailscaleheadscale%E6%90%AD%E5%BB%BA/"><meta property="og:site_name" content="松果小站"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="松果小站"><meta property="article:published_time" content="2023-12-28 10:30:00 +0000 UTC"><meta property="article:modified_time" content="2023-12-28 10:30:00 +0000 UTC"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.e83ed60f44a866830eb8ff84b9b1ceb1b585dff20463c785c1f71ea16bf54e9c.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"%E5%BC%80%E6%BA%90%E7%89%88tailscaleheadscale%E6%90%AD%E5%BB%BA","permalink":"/post/%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/%E5%BC%80%E6%BA%90%E7%89%88tailscaleheadscale%E6%90%AD%E5%BB%BA/","title":"开源版tailscale，headscale搭建","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>开源版tailscale，headscale搭建 - 松果小站</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>松果小站</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>松果小站博客</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-categories"><a href=/categories/ class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>分类</a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>标签</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>139</span></a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-overview-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#headscale-部署><strong>Headscale 部署</strong></a></li><li><a href=#客户端安装>客户端安装</a></li><li><a href=#windows客户端>Windows客户端</a></li><li><a href=#linux客户端>linux客户端</a></li><li><a href=#群晖客户端>群晖客户端</a></li><li><a href=#openwrt客户端>openwrt客户端</a></li><li><a href=#安卓客户端>安卓客户端</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=松果小站 src=/imgs/img-lazy-loading.gif data-src=/imgs/hugo_next_avatar.png><p class=site-author-name itemprop=name>松果小站</p><div class=site-description itemprop=description>记录轨迹。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>139</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>33</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>110</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/jooejooe title="Github → https://github.com/jooejooe" rel=noopener target=_blank>Github</a></span></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站1</a></li></ul></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-gtranslate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/jooejooe rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script><script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=/post/%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/%E5%BC%80%E6%BA%90%E7%89%88tailscaleheadscale%E6%90%AD%E5%BB%BA/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/hugo_next_avatar.png"><meta itemprop=name content="松果小站"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="松果小站"><meta itemprop=description content="记录轨迹。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="开源版tailscale，headscale搭建"><meta itemprop=description content="Headscale 部署 Headscale 部署在 Linux 主机上，随便找台有独立ip的vps就可以了，但是要注意，如果需要穿透的内网无法打洞成功那么流量就会由服务器中转，这意味着穿透"></span><header class=post-header><h1 class=post-title itemprop="name headline">开源版tailscale，headscale搭建
<a href=https://github.com/jooejooe/jooejooe.github.io/tree/master/post/post/%e5%bc%80%e5%8f%91%e6%8a%80%e6%9c%af/%e5%bc%80%e6%ba%90%e7%89%88tailscale%ef%bc%8cheadscale%e6%90%ad%e5%bb%ba.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2023-12-28 10:30:00 +0000 UTC" itemprop="dateCreated datePublished" datetime="2023-12-28 10:30:00 +0000 UTC">2023-12-28
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C itemprop=url rel=index><span itemprop=name>开发经验</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>1827</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>4分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/post/%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/%E5%BC%80%E6%BA%90%E7%89%88tailscaleheadscale%E6%90%AD%E5%BB%BA/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class=post-body itemprop=articleBody><h2 id=headscale-部署><strong>Headscale 部署</strong>
<a class=header-anchor href=#headscale-%e9%83%a8%e7%bd%b2></a></h2><p>Headscale 部署在 Linux 主机上，随便找台有独立ip的vps就可以了，但是要注意，如果需要穿透的内网无法打洞成功那么流量就会由服务器中转，这意味着穿透后的速度会直接的受限于节点跟服务器之间的网络情况，所以尽量选择离你近的服务器，即使打洞失败了，至少网络还是稳定的，通畅的。</p><p>项目主页：https://github.com/juanfont/headscale/</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 下载服务端</span>
</span></span><span style=display:flex><span>wget --output-document<span style=color:#f92672>=</span>/usr/local/bin/headscale <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>https://github.com/juanfont/headscale/releases/download/v0.22.3/headscale_0.22.3_linux_amd64
</span></span><span style=display:flex><span><span style=color:#75715e># 设置执行权限</span>
</span></span><span style=display:flex><span>chmod +x /usr/local/bin/headscale
</span></span></code></pre></div><p>准备</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e>#创建配置目录：</span>
</span></span><span style=display:flex><span>mkdir -p /etc/headscale
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#创建目录用来存储数据与证书：</span>
</span></span><span style=display:flex><span>mkdir -p /var/lib/headscale
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#创建空的 SQLite 数据库文件：</span>
</span></span><span style=display:flex><span>touch /var/lib/headscale/db.sqlite
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#　从example 创建 Headscale 配置文件：</span>
</span></span><span style=display:flex><span>wget https://github.com/juanfont/headscale/raw/main/config-example.yaml -O /etc/headscale/config.yaml
</span></span></code></pre></div><ul><li><code>server_url</code> 设置为 <code>http://:8080</code>，将 `` 替换为公网 IP 或者域名。</li><li>可自定义私有网段，也可同时开启 IPv4 和 IPv6：</li><li><code>ip_prefixes: # - fd7a:115c:a1e0::/48 - 10.1.0.0/16</code></li><li>随机端口要打开，否则同一个内网中多个终端会有问题</li><li>randomize_client_port: true</li></ul><p>创建 SystemD service 配置文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># /etc/systemd/system/headscale.service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Unit<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Description<span style=color:#f92672>=</span>headscale controller
</span></span><span style=display:flex><span>After<span style=color:#f92672>=</span>syslog.target
</span></span><span style=display:flex><span>After<span style=color:#f92672>=</span>network.target
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Service<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Type<span style=color:#f92672>=</span>simple
</span></span><span style=display:flex><span>User<span style=color:#f92672>=</span>headscale
</span></span><span style=display:flex><span>Group<span style=color:#f92672>=</span>headscale
</span></span><span style=display:flex><span>ExecStart<span style=color:#f92672>=</span>/usr/local/bin/headscale serve
</span></span><span style=display:flex><span>Restart<span style=color:#f92672>=</span>always
</span></span><span style=display:flex><span>RestartSec<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Optional security enhancements</span>
</span></span><span style=display:flex><span>NoNewPrivileges<span style=color:#f92672>=</span>yes
</span></span><span style=display:flex><span>PrivateTmp<span style=color:#f92672>=</span>yes
</span></span><span style=display:flex><span>ProtectSystem<span style=color:#f92672>=</span>strict
</span></span><span style=display:flex><span>ProtectHome<span style=color:#f92672>=</span>yes
</span></span><span style=display:flex><span>ReadWritePaths<span style=color:#f92672>=</span>/var/lib/headscale /var/run/headscale
</span></span><span style=display:flex><span>AmbientCapabilities<span style=color:#f92672>=</span>CAP_NET_BIND_SERVICE
</span></span><span style=display:flex><span>RuntimeDirectory<span style=color:#f92672>=</span>headscale
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Install<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>WantedBy<span style=color:#f92672>=</span>multi-user.target
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 创建 headscale 用户：</span>
</span></span><span style=display:flex><span>useradd headscale -d /home/headscale -m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 修改 /var/lib/headscale 目录的 owner：</span>
</span></span><span style=display:flex><span>chown -R headscale:headscale /var/lib/headscale
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#修改配置文件中的 `unix_socket`：</span>
</span></span><span style=display:flex><span>unix_socket: /var/run/headscale/headscale.sock
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#　Reload SystemD 以加载新的配置文件：</span>
</span></span><span style=display:flex><span>systemctl daemon-reload
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#启动 Headscale 服务并设置开机自启：</span>
</span></span><span style=display:flex><span>systemctl enable --now headscale
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#　查看运行状态：</span>
</span></span><span style=display:flex><span>systemctl status headscale
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#　查看占用端口：</span>
</span></span><span style=display:flex><span>ss -tulnp|grep headscale
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 创建一个 namespace，以便后续客户端接入，例如：</span>
</span></span><span style=display:flex><span>headscale namespaces create default
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看命名空间：</span>
</span></span><span style=display:flex><span>headscale namespaces list
</span></span></code></pre></div><h2 id=客户端安装>客户端安装
<a class=header-anchor href=#%e5%ae%a2%e6%88%b7%e7%ab%af%e5%ae%89%e8%a3%85></a></h2><p>目前除了 iOS 客户端，其他平台的客户端都有办法自定义 Tailscale 的控制服务器，headscale仅仅是实现了tailscale服务端的功能。</p><table><thead><tr><th style=text-align:center>OS</th><th style=text-align:center>Supports headscale</th></tr></thead><tbody><tr><td style=text-align:center>Linux</td><td style=text-align:center>Yes</td></tr><tr><td style=text-align:center>OpenBSD</td><td style=text-align:center>Yes</td></tr><tr><td style=text-align:center>FreeBSD</td><td style=text-align:center>Yes</td></tr><tr><td style=text-align:center>macOS</td><td style=text-align:center>Yes (see <code>/apple</code> on your headscale for more information)</td></tr><tr><td style=text-align:center>Windows</td><td style=text-align:center>Yes
<a href=https://github.com/juanfont/headscale/blob/main/docs/windows-client.md title=docs rel="noopener external nofollow noreferrer" target=_blank class=exturl>docs
<i class="fa fa-external-link-alt"></i></a></td></tr><tr><td style=text-align:center>Android</td><td style=text-align:center>Yes
<a href=https://github.com/juanfont/headscale/blob/main/docs/android-client.md title=docs rel="noopener external nofollow noreferrer" target=_blank class=exturl>docs
<i class="fa fa-external-link-alt"></i></a></td></tr><tr><td style=text-align:center>iOS</td><td style=text-align:center>Not yet</td></tr></tbody></table><h2 id=windows客户端>Windows客户端
<a class=header-anchor href=#windows%e5%ae%a2%e6%88%b7%e7%ab%af></a></h2><p>打开http://ip:8080/windows</p><p>下载一个注册表修改工具，执行一下</p><p>安装tailscale客户端</p><p>启动，登陆的时候就会去我们自己的服务器认证了</p><p>认证成功获取到ip，客户端就加入网络了</p><p>打开cmd，执行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-SHELL data-lang=SHELL><span style=display:flex><span>tailscale up  --login-server<span style=color:#f92672>=</span>http://ip:8080 --accept-routes<span style=color:#f92672>=</span>true --accept-dns<span style=color:#f92672>=</span>false --unattended
</span></span></code></pre></div><p>再去服务器端激活</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>headscale nodes register --user NAMESPACE --key nodekey:xxxxx
</span></span></code></pre></div><p>NAMESPACE修改成相应的空间名</p><p>查看节点</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>headscale nodes list
</span></span></code></pre></div><h2 id=linux客户端>linux客户端
<a class=header-anchor href=#linux%e5%ae%a2%e6%88%b7%e7%ab%af></a></h2><p>直接下载。查看最新版本：https://pkgs.tailscale.com/stable/</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>wget https://pkgs.tailscale.com/stable/tailscale_1.56.1_amd64.tgz
</span></span><span style=display:flex><span>tar zxvf tailscale_1.56.1_amd64.tgz x tailscale_1.56.1_amd64/
</span></span></code></pre></div><p>将二进制文件复制到官方软件包默认的路径下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>cp tailscale_1.56.1_amd64/tailscaled /usr/sbin/tailscaled
</span></span><span style=display:flex><span>cp tailscale_1.56.1_amd64/tailscale /usr/bin/tailscale
</span></span><span style=display:flex><span>chmod +x /usr/sbin/tailscaled
</span></span><span style=display:flex><span>chmod +x /usr/bin/tailscale
</span></span></code></pre></div><p>将 systemD service 配置文件复制到系统路径下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>cp tailscale_1.56.1_amd64/systemd/tailscaled.service /lib/systemd/system/tailscaled.service
</span></span></code></pre></div><p>将环境变量配置文件复制到系统路径下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>cp tailscale_1.56.1_amd64/systemd/tailscaled.defaults /etc/default/tailscaled
</span></span><span style=display:flex><span># 启动 tailscaled.service 并设置开机自启：
</span></span><span style=display:flex><span>systemctl enable --now tailscaled
</span></span><span style=display:flex><span># 查看服务状态：
</span></span><span style=display:flex><span>systemctl status tailscaled
</span></span></code></pre></div><p>Tailscale 接入：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>tailscale up --login-server=http://ip:8080 --accept-routes=true --accept-dns=false
</span></span><span style=display:flex><span># 如果申请为虚拟网关，需要指定
</span></span><span style=display:flex><span>tailscale up --login-server=http://ip:8080 --accept-routes=true --accept-dns=false --advertise-routes=192.168.188.0/24
</span></span><span style=display:flex><span># 打开转发
</span></span><span style=display:flex><span>echo &#39;net.ipv4.ip_forward = 1&#39; | tee /etc/sysctl.d/ipforwarding.conf
</span></span><span style=display:flex><span>echo &#39;net.ipv6.conf.all.forwarding = 1&#39; | tee -a /etc/sysctl.d/ipforwarding.conf
</span></span><span style=display:flex><span>sysctl -p /etc/sysctl.d/ipforwarding.conf
</span></span></code></pre></div><p>执行完上面的命令后，会出现下面的信息：</p><p>To authenticate, visit:</p><p>http://xxxxxx:8080/register?key=905cf165204800247fbd33989dbc22be95c987286c45aac303393704</p><p>在浏览器中打开该链接，就会出现如下的界面：</p><p><img src=/imgs/img-lazy-loading.gif data-src=images/Dootask%E5%AE%89%E8%A3%85%20%28copy%29/2022-03-20-17-06-08qWbz.png alt=https://jsdelivr.icloudnative.io/gh/yangchuansheng/imghosting3@main/uPic/2022-03-20-17-06-08qWbz.png></p><p>将其中的命令复制粘贴到 headscale 所在机器的终端中，并将 NAMESPACE 替换为前面所创建的 namespace。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>headscale -n default nodes register --key d1614a1407b7554cd368db21f383197802d9c95249130d7b3db256458d9a4043
</span></span><span style=display:flex><span># 注册成功，查看注册的节点：
</span></span><span style=display:flex><span>headscale nodes list
</span></span><span style=display:flex><span># 许可路由的话，通过上个命令就可以看到linux节点的id，就是1，2，3，……
</span></span><span style=display:flex><span># 查看改节点的路由，假如id是1
</span></span><span style=display:flex><span>headscale routes list -i 1
</span></span><span style=display:flex><span># 许可网关
</span></span><span style=display:flex><span>headscale routes enable -i 1 -r &#34;192.168.188.0/24&#34;
</span></span><span style=display:flex><span># 再次查看虚拟网关状态，id是1
</span></span><span style=display:flex><span>headscale routes list -i 1
</span></span><span style=display:flex><span># enabled就是已经启用了
</span></span></code></pre></div><p>回到 Tailscale 客户端所在的 Linux 主机，可以看到 Tailscale 会自动创建相关的路由表和 iptables 规则。路由表可通过以下命令查看：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>ip route show table 52
</span></span></code></pre></div><h2 id=群晖客户端>群晖客户端
<a class=header-anchor href=#%e7%be%a4%e6%99%96%e5%ae%a2%e6%88%b7%e7%ab%af></a></h2><p>项目地址：https://github.com/tailscale/tailscale-synology</p><p>下载安装包手动上传到webui，安装启用</p><p>登录到ssh命令行</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>tailscale up --login-server=http://ip:8080 --accept-dns=false
</span></span></code></pre></div><p>剩下的步骤跟linux一致</p><p>如果需要群晖做虚拟网关的话，添加参数–advertise-routes=192.168.199.0/24</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>tailscale up --login-server=http://ip:8080 --accept-dns=false --advertise-routes=192.168.199.0/24
</span></span></code></pre></div><h2 id=openwrt客户端>openwrt客户端
<a class=header-anchor href=#openwrt%e5%ae%a2%e6%88%b7%e7%ab%af></a></h2><p>项目地址：https://github.com/adyanth/openwrt-tailscale-enabler</p><p>按照项目的安装说明安装即可</p><p>安装完成，启动服务后，执行跟linux和群晖相同的命令</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>tailscale up --login-server=http://ip:8080 --accept-dns=false --advertise-routes=192.168.199.0/24
</span></span></code></pre></div><h2 id=安卓客户端>安卓客户端
<a class=header-anchor href=#%e5%ae%89%e5%8d%93%e5%ae%a2%e6%88%b7%e7%ab%af></a></h2><p>稍微麻烦些，需要自己去github上生成release，这里就不写了，直接提供包出来</p><p>重点就是指定服务器的地址，如果不指定的话认证服务器是指向tailscale的</p><p>要想自己指定服务器需要从项目代码中自己生成一个</p><p>可以在github上操作，总体来说费劲一点，这不是本期视频的重点，我就直接把我生成的客户端放到蓝凑云了</p><p><a href=https://wws.lanzouw.com/iRZcQ0als9sh title=https://wws.lanzouw.com/iRZcQ0als9sh rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://wws.lanzouw.com/iRZcQ0als9sh
<i class="fa fa-external-link-alt"></i>
</a>密码:dwsn</p><p>安装完成后别直接登录，</p><p>登陆页面，右上角有一个use login server，</p><p>打开，填上自己的服务器的ip和端口登录，同样会跳转到一个页面</p><p>复制给出的命令，修改namespace为default</p><p>去服务端命令行执行一下，认证成功</p><p>安卓端就搞定了</p></div><footer class=post-footer><div class=post-tags><a href=/tags/headscale>headscale</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-nav><div class="post-nav-next post-nav-item"></div><div class="post-nav-prev post-nav-item"><a href=/post/office/windows-%E8%A7%A3%E9%99%A4%E6%96%87%E4%BB%B6%E5%8D%A0%E7%94%A8/ rel=prev title="Windows 解除文件占用">Windows 解除文件占用
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2020 - 2024
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>松果小站</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.121.2 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.5.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script><script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o \n\n可用快捷键选取表情符号：😀😄😁🥳👻👽👀🚄\n(Window系统：Win+.，Mac系统：Control+Command+Space)","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.0fb3547374c917d23a2e5f762b70f3698d20b46a01cc18c38f9c467aeffc99fc.js defer></script></body></html>