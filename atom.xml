<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>松果小站</title>
  
  <subtitle>松果小站博客</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.songuo.tech/"/>
  <updated>2022-01-26T04:00:42.260Z</updated>
  <id>https://blog.songuo.tech/</id>
  
  <author>
    <name>松鼠</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2021团队年度总结</title>
    <link href="https://blog.songuo.tech/p/56df510a.html"/>
    <id>https://blog.songuo.tech/p/56df510a.html</id>
    <published>2022-01-26T01:09:00.000Z</published>
    <updated>2022-01-26T04:00:42.260Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="14fa9f8e7dd1465156d3897f588080fcf397395a5a603fe575a9e4e7f64eb6df">dcb9484e019cb987ad2473f96c02d851ef1c25a1a897233a63293a7d859d05eca661012592f79a5ae9e92329a318b8bb261e8dd422540445caabc0e686768fe57a97d8fb42af56d9701cf6908caec7870f88c2a09e944b71b593b934144974509a2a17543263f205e9687acdf35eca810a85f4bd8f848681134a7a4af012aeaae6954906797b42856c9a0a63d18e51910fb0dbfd40ea7e59c02de97983153924ae4f1ab1d28c452fa83f098fbff915f61adf0c7b9bb1e61ffd258183ef0086bcaf8eeee9ac73850f557f9e594e4af0998f9efc5d56f7eb26d6b4688c8eb0582fc9a481949af869553373fb8d2600187bb13bf73f9d87df03fa4d9b542abde400e8fcddab5e043d220ba18d3cbf5e8c388cdc14a6cab2c9be89c3223e78b3e7832d41b29e027d9fa3e1f8e23307ebc036dc01795c394dac85afcd453c57509635af0585e64fb335219f7cd01850a8bb91dfa9c117cbcad64bea466e30190e6ece01b895afdaae4b8e8f2bba8efa4477bbd049a4199c55798235569c71a4aed6f8a5f8a7bfdda4aaf2573b99107e8529e2cdce338ec0168ae49df62fcaf6f497cf4e65c76baddb0b955b9e33d19efdfad85c6feb207ee2c7cd469e45b56430270ce55782d11bd0e6813e8d1696ca450ac4c06f9c1bf3fd8f5cd0d3f7998d9a56a4eae0ce965ab9a912af738130830fe0c9912e987adc6184df7f6f212a4595647cbbd6eaa8888930efbf7bccd07b1382953e08947a213513b18cf2e6d5219878fc978581c3eccd48f62b26aaa1137c31fa58c21439f51b5967af5c9ce70633d4a341f71fd1db3384520b69cb7a4dd56229b63c06cf586ca37cc7c6df3db7760e55f1faab0119ccf9c1b6863f04eafb413fa5800d44adf301a364e2b285dfed878a02ed258290c540bf02197f5816f7988948cc8e80654302a8fac83ee99a35481d09b3587a6acb890662082224a7727c5946881c24dd0b925181aa48c035c6ab7e194198d545f387884689d66c392fa9d5ebd3a0ad209d0fb23e3850aadef74eb595dad921a0a0f4e12ca280ac712f66fa628d642ff5dc6f190e0d4b516d379d011343b80dd9f2f0498edc7694a56fe9cf593f5c3a4ddedf6c2bd45b5bae5f03d8f0601699c4bc4c5540bffbd71b1a36085086f30a8c22548ea3d7107a21a6c7d1f6932079e460318f73eed18a782caab8b733b8277e1f2acbff714eca2ca79951ac48389027436cdd9e5ac0f8e4616b6de1d3a0fb4388bb860c1b03238526198df5af61870e40f6928c7da68aa92233afd8ed17cfaee083ae9e1fa0bd3b0c7d49709f58072c809e566c3710592808dac3ecb460bee0b8acbb2e6da8a716b73e8bcd99efa8d6c80b2ed056e5720bd7bee9206950bcb011913783ccb482e8402306a8540ad4d066d9e297b88a8084a530ff040da71eb6b3939d82479ded402212ab85f550a507e74ec1ab10ad93acf9d616469eeb24a079c79865bc108740f0e79d4d9fe84b5d8b33286e5362fff56ab85fb1313164d5322ed29c720fabc04293cb0024eb2db75f80c215c5c074e5543b11d79bc436e779e6972763c5356f7e0e5347d69e9f174f830be5fa44912655fc83135fb64fb0edf004f646b98eeae696cba92426a4e864daaca50bd85359dec4dfd69d81e232b33e7c3e0b4945d7575fd3275bb6b0c389005f06ba6b531d41b63aa0aa9da46b23afcb93ba1da8229888cb019a9c7d67bc0f9297ebff39e8e34ee3126156ca3d991ae0ba1bcad3476cb359e1b4a983efa3f49b378d8ddc1c4f762a60b86c73176d7815b5490b36e396af60258a1499acef00ce692ffef866bad203147cc9328fc0df77a3b4044e78ea61269cc4d8b817112c0ee1fa0e8c89005d96fde1944e5e7b9958adc4d47f1ea89c1933f80238074fa57204ecb919b2ae72dfcf8fc0884194a92ddbba6dbd5f68295d6c92d712e028d7acd8475c024b56b6b70b3b54551998b98e60984b22d79aea2689eda17add7312147be3136128e2d3c88f79d0a39f277ba0c0a6c6a1712bdfbb2e54b24a6f616fab097c4a2177e99d05c1c403e7d0293c481c547333dc8439b26721309bdaca601fd6e9134044738bddb4621d8a36d3cee54229537a599662a2d2aea9c9c445a95b405cc124308e778b351ef969141423abc0436f26fa2c39246ae2580352c8b821f0d2639636b15368372ff3a7694d830a2a15674bc2732ec963ae34c48050ce122b5bf3fafd44bb8344f188bd2ad0c9be11f7b7110e137a55a629e8458fc561cb60fb2b37557ffc09b5144b531810e87dfc35eb62f1ba566a328e142dfd30acf40d9e35dbb9c01a7f11c6e153b4f49bbe6628d1742a141c085b83dc90f96a58f5ab1b354ffb2a480e2f6c069a1f44079f79671503c299d32094e6f69cb2cb3d065056ff226d59f3d964df8d4d0bf68c0683865aefd5b8bbfeaa390687b76448fdf2b56256b8293d39d443ec462d9c84578cfead64b54311a1d0f8d3719fcf9655096012079f0ac4d2f4a6c297f3dbcbeb0c135f34f9061095352b20fead0142f057c254c4318a53bcd24538523072da2bdb1271a3b471985271245a32305ca0a01eb930261dbd95ce4fc5b2939e99e1829ebb68dbd8f6561692631969f4db42a5c2f2443f122f3b04db3a032e7e18775b5fd58f380dd576013286c6d70161410591424e5d7d6c502d88f3592e0805b8cb0d7b2adac6eeb20ae150268e40fee2895d087465e01475c99b174e2db7a0b2319ff0d34dc826f5671f8edc0280ab3340566e8d524a132d6ba307e164cd14250b474f63c19de20d9208c7c638c98451285844c0c7ed9126bc5fc6bbae490b4e69aa84bd45342bcd6c44e57f50ea59d2ed05a5e4cd5bb396ddf59c62d837690645c10091f6f3cae1b4f538c3aa300b373435771b6109e420d9948ddc752559aed94348a2b327381372915a9c17d5a63be73e0a57dcbcc1aba50f69b7f4eb67a0a87ef3728e4dd3414a26305a29ac6a6fadc9f6ae80c809cff595b10d6790ac52adc45c43fc685b323cc15482e573a98c9fbb5170bf7021cfb2f8673c38973d8504d33a998c20fc38b4254d2421506422d305584370daa05ef455820949fde38cdce17095b63e0d11a6b627b6f02e75941966fd816b7ffce3a0d27a0013af5c78cec69385733d88729783ffe29fcc7b0b34c657dced441688d8d8da6fd360108753a038df58c1f72b3586ddbb2cddfb591ab1e4b7e8dcd82f32ea3b1cb9049d1ba9215fb67a92dfb3512c36527741e05cf2e8ef71296c510771bfd18bd7d61ce70f23d91500c94b171ea7d74063925f60c5ad615f367a8a4d9fd4c74b5feea90302ce7f82327d102cf8fd0d72030a4b3ef9ce11d631b33cbc947f1f7b5f8ffcc42335685007b2b53fe88b1c7ffd28cda58ffd8c7aadbe6af112c203ae1af350c1f1bdfdc73d5d2f3b5290a5eaeaed621fa53f248a569a237086385181e9621a8e5ea9163892bcde9f7fa0848dfadf6ad03556c46b824e5b117a9dc8d953e02fa9f3fcff06244fed8da50370d8337b9c4e4f5496f623eae21c3b171042b47e94cd4e46fca406586be898fc097ce32e560c0d80913126539a2ad272a4dfbc76f45f650b08d744e0751f16cb712332bf7fbe89b2317f749200c585cc62663edb2717158d10161e1a4ff31938619b105247602020472e596762f7c028f3387e2da9ca3ff03500d7f9645236f88ac4ab9946128047031d92b565e951b59d5badf7e9a7834396532bac111e866d597d945991370ce9928056322da12a4840c5dbb52db3b993bf5fe98f88f27f2cc078d90556c035b6c6799c16a3d89a11049fd069a02f896491c6ab92ecd249c531b815a24b8b0f4a3e0031f9bf32c2b73075ed3f6a3aed6b9153f6ac086fc78875a0013a755c2932d7234d0e3d842ad1e762f67a948ffcc87034382abe0d734c75bb7813da05694b34097dda30831e545948018780c3ed3cad4104de2b57b99a7a104a5b22d06a451d58f538b43ef287de8b3516f0541ec2f510097394b63bf1aa2b1ffa8aa069a37547fb4f9512c8d1c592293818a0f725d2df4b2c662deb59864eef3d3d2f539a006aab6b1b8e7843df425931fe36a70b8aa7fda839468d88fecf3ab3d00de97d34170cb38e2e508d9466fafc9a0add35c4129d3e56b7325cd5ddc160b71f422a090cf18f8ec742e691c2fc5b5f2eeb5064819777fee2b751d8128194c5f3d4b40b2fd0e6bb0233fc876d5319a596eab50b46a61db872e52f702e24f17593a5150fe0584189df9d329caa215b5b763acd1a4813268a178fa58d92a91a82984232b58dad58d85b5f823e4352c1bf5c3504882397bb25adc337a8ce32199cf61b935421facedd759ea17073c18427a613ea5844ea1fed7f3fe56ddc4f3d6c5c7579105330a92b742a65b0c573f67dd96c0fac9c3c155aaabe7285df51080078eac2dccbcbd346f8eda0ed756c27bd47e3c51b94d424099cb6ef805b9bae2a1087cc843dca737492000a18b9ed7dffb1c2456eef71a1079694e24cf656cef3a540e2ab6b2a993aaa4d98fb2779732956c57e54449172169c8bf707ebcca3c283c425d73a55b1e43760ba2bc56330b829c2225149c50f238e9ec0937f0e6f2dde72b62e68de5137f7748a02ec7875d609f54d1d013f2b3d44df95c63ba674d7727b723231fa5e442b25806e650f1dd458f9bfebb2ed5dd25b7197996a867d800a016e29d008fc65a3830e5820d29b3b41e34db9e91e24a91e282dd35f955b04fa35049b38b546fa09b6c18c86be4bcfa31ce6289b2f0042862b1f32ca7efc50e9ffcce1b50146c63244e18943b39198f0a13938b88143834c78282a591aed68b78e9ed5673124bcc7da51b03753a1f16694de15361dee5aad7584416dc5e9932c219657c9323989bccd0cdd2ac4340b7c34e369185309a6a0a26e13e55b2ec98a7997ee34dcb7ab2b5d47f483e2cfa3b0b56315a9378a1d3f3b774520e0e2b822f27d104d0fd2ea5b4e0fbc91df66f75314ceea76348267642c8cf563c29ed4a52b9de01b105c0a21d5d737df5cfc1cbd68f5774cc0129f8a169c0ea0aa6dce25a913d1f7175a160cde7234547e94641b90821d8ee0c2457de538af102a91b892faeb7a110033c2cded4ca6c7ee79ef108a82bdcb89364c8dce2b9c6002c0c4c32d6a4d1ff24a2f8a964b7d9adda999317013d03e474b067ef7d49238f4944e1ef4363fe638e0a051536dbd3c63f6559620fe3fc091cf3d5d080359e9120adfe2188cc8ef16cd57c7c8b90b3237d80b0b81dd505744eaa2c3ffead19ee84569e4979bbb8bf7079b774fa798db4d2b276a0923d2d43e45e15358f95aac9646b4c9df5b36e3643e713eeb90a1324f687ba2f4cfb4344afef339ab58553747b853e588526021df761eb85c3b029a226ea4789ce2a3c6ceb511310ad9597a1d1c9d694e07e6566cc20f78e4d51696d481ce6be6f8af9bbe5a7ae5687c1ab7466a36c570a6e8f5f6369faf44afe0937a1a21ca71e35a180c8f665290b06335f672b4637af233675a54c5a0be7b5a6136f64bf538bd8f50864abfaef23b46162a09f4842eb42f442e74b8b25ce335d8174bbdae6497b9b41cc83ba5084de00d82aab29795a67cf51c9c81548a95e2272f3868dcec1c51a5cbd9543a3815dbe382cb46af597d7e73f4b2b86028456f6ca7f9f637e0899dd1319fccaded00200761dadf83370d19cf003490b91944b01221b980a903f4fcd3baf3bfac229b7d56e20911fa890ee0123b1dbab2e8c5e124e40210ee028bc23830df444856c328179564abe33f15e28df7cc5815071b15ccff5991f38e756c6056f23b0f722caf10d48fdada29a7b59f4a1a832a33f34f87c13081bab31bde070222fbeb0fe635e86b37a3f638211ef8db59b3d0df7a5b330221d54833b1e05cece6960b103730e017de3b1b1e1d1a0c092a6228b6948daea62fec42a3220f268d52132d4cc3333f6bc5889c6e53a86603726fdf5a7f72e7d3c1f91569aea0f0b31951f406f964494b43bde003e68494dbf07fc714c844e68a823d0842017d67f4599d1d02be76d31a5dbc9092daa350aae4de2effd9f68426eaac95b032cf79410645b93440094157e830f91bb45d4b0b5fe01fd87565b5e84d746cfe3224adbaf1a097722c08027a0fa737d7e5093b41ed59011ffd55dd7bcb555f6658f7fea3f9dbc62f361228e9405e6cad368d1a2e4a41b3c3369353920b057e186d7ccde905a23cfff86c695b58b48c22013d75d1b765974cf542e1fb460081d087698a4ef10cde54de11220a65febd58faeef8682ff75cc5775d30512ed2ffdd62b60d377e351a9d17237de69619410bc86a06b856f108221834cebef64adc4f60d6633b8fced4f4c2f93f69c08ea67476d2371313967f0e109bbfa5b1fcc16ea86e382c049f1631259fa93796c9f1f9c5236eaeb15058c2594de16b3635484df9f0b962e0dae99e46d35f6a6b899f95c3921ba125f28705fc1f98e3d84baa0b043aeb0fce5e06a35ec910b856f4eeb3810af7d4153dea6fd79218c204dde06034348f78aeb736b9a452f305fb36743cd2a7726c9d6d53ff0bf4d97c260fe689f383290c5c53a48e022b7b929889fc0f377d677a35cf37179983a32e437d29dedcd7f3925ddbe4d60152707d69ef4aa626b30e005575c1e1a04232c6480938ffed36c5e761619d621fc43034f36191c1d538bd64d2da7855896803b502418947b5bdad60618f09868065a936c3ca72ee2148c42f574f8d0b5aafde93b1332ff42a462d584aae0d4654504c24e0f8c04e97d4df034a25a986a8b408d748c621ea1bee30013f441786e413f2687bd423f6fd07f98a1f53434d39a4f4a76609991a93f31437dc6a1d370a591d1fca88f197312a2d1bb0bf1b45929b3cdfaa3e114696c4d350a72c537870cf69c2440691b8362f0c1a94bfa3f816eeabf7375cf12880ba290c947978eb1f097105fefdb81790f0f0f9fa86476944bd2fcdb2d9710466a0bc3bfb8d685c7fd5dd9aff4220e65fec60dacaeccff2c6fd69f4c0e62e659ab79ae587411ed9ab439b2f204e644cc191372a3d2f0a2055edf6642cd7289abae8181f4e814373f047e8ab06184eda1cb4ab6c74babf26bec66d0259bd54da30d6e5bccd3c5db1b02c5143a85ae16db49e0d124ee4bb58eff006a2b4a60a0501c6e7fb87fe6f1a51f6cc4d067c21ba750957609108fd1706c1dd5c52084a4704fe7bb7651d82f59cef1e5e9fb74a2cf34ff6632ee62eeb35c6f90082e7333622009c52513a1d30b2d56cc4717224f2916b0c9197ad43d5c92111f96f5d2e573e121dfb33f5b44db9703a319414fae359a8f8990f6df1afc549e8a913ed847ae9851520e334ae213b767624e095bf3dfaa0e3fb15ac0d81a14963aecc57e2246cefcd3a0850949712a4ecef3da2201413f54b2b8cc786384ddf6adc6c4d0ae564705c2c29e723b39d76de28f664f91ba9983e3e57ef5d6775bb70362382ae3e0d5380a71e89c32ddd7cc2d172a7a0502d913f086616e88b19c95ef1f6e9b5e4ac5c6e040599981dc224a8c06bae99de397307a52739acac501f3de3e69ba4efd6cce75e63f8221e35a8dc1d461e694c6c531b6cd70907fbb7081861e40e6305a492b1015b16907952b07da3319a849a94c17c0b1859dd47fc5c1b42a89fbd36dee44e0a6516f7801688c15adf347e7cb7630975d846e86e026996fd44ba99b662d956d5486735c80a16349f7faa6653cdeba2df4b77f7d86f6e9b9fb068f627c3ba334667cb27b5dd252d009b1cd213e71e340e4534965a0ab5cf9f11a07df99a8b26635a264c18297a393b794e72894f1dc639b873f32471866762997dc7079e7ecf1b759c024756aacfbec5e21b9e7e418bd8709db3dea5ae7e5ef34f9b2b9cf3d7a860556ad7331dc95443891ee63266d65c77c0b8cc1c5b29399e583aaeb5b25cd7d299a3cfe67bd49d1272789b9fe678bb8080b0663ce00ec184ea4dde9c4948841e9c08b80cab74df6df7565d791de22808b18800851ea1202ff959d6428e056d8be4f0b3137c376ac7b0616776edcfd8f78a948d534917bf7b67809a211ba34a860d8402ae718de25ce828a4af8408d8a8b2100b7e45e83dab238ec4214ba7ecd7ca319defdeab73b0cb1ebec374581accb6f67000a3ee65f3ad54f41107c66226f023c7c9a0945b69f3c7df5929b06dae88cf6ef71920a0250a408a4792c06048ee79ac547934a8b0c4eb3104feef7124d6e2357a9bf680157214624c8a5d827fb0125bcd7a398d32cb2d3525e5bc95799b1235f5a3960b269b4bdc65a0a95f6299ef0bf88f59bf65f3044b794f815f33c099126145418c0631cf77ebedff78db21155494735a5095b0cb4fe5cf8fca2313cf768389b5860a62f7c11e77f6a4867f156011ed3f6d59f388c00e3da8edaf90b74dc50f58d2568a94c97c42c6df3ccffe4bbaf62229c4bc56242243c07c0bad858eaef4071350adfc8204446cda71b0b33278a02151de8fbd045cad6237b67efe6addf65d37335439126f263ff3c5b9227013d6534dca73519beb804ed2815b3f1720a01a12bca75155f1d6ddaa9b47189002a20a5ee1d27ab413726f2705bdcb7e8eeb603e4697a060ddc73e0afc9e0b52cb6c900e4b94127e57a0f78c1b668f7bee5f838b7d52d16b76a321062f600478c986d8d28d05c4fd4df41fed86a239ec2133278403ab307846cb0c4c70841fa7ebb6e68c523c774e6f1a7a4cbb4f706e7e424cabf5e958ee961c4719c8721a950b56ce0ba1f3048ba0cc6097efb081c9da3d6921bbe1525366f10b6ddfe2bb0a9ca22fe697872d3b8690f7395a9014ace80783966f0480184b0abdd711eaa2bf9986d2e2825051bf5d5d7fe073a82cb2e2b3e27544c7ca703fbde8db641c6cce7a45e241caaeb18329fd38e0aaa29fab632f76c66339d7addedc027ad79d0131d64bbad75a620d10a80a905cc6e20a1f60fc30de3bcfd14c4b15ea4246fd38ad81dd15a1166411cef2663dda57cc4582b6a9f616a41c92e05a2749074b187699a2855fe36d30acbef92018931dbb547d4b1785c96471fc42ba3bb312519074e8c9c86c3249bb60d938e21f2f7d213632a3c281543270d913f75a73aba193ac09b55ca328ba6524fe27f0e6390d62d97c5648e292aeab78150e97eeeda0af1f157f1666dccb4524d13b60f6e826858247e9ef3186722a168898a1b2be2df61c0a0f2dbc7cc05d1160f80e8b45bc052ef67ac2372b8d1f083eee22f1a14254c9d1bbd6f080d407d20ee294f8012b117bf70e77fc5c684a0b0c671385c27d0d4913b4273c15bbc74824ed11f95f3682e4a64d1a38a4cd091c8683ee583b0cd037d60ff373e80ab779f1e420da06c9c2d14e312acde20b3eef54acb099513ad5386cc63583e4d90c93916ce8d11e8ba6767d07c020c33651583353baa0a777ea11245421766b894c43e88d4c63520d558f3a2c90550e17b77fb2412e728dd9c0685a007b77dce30a92a82510bfb3046800b02035afe2b9481d46a8a0118a8adca585139eec050bdf02d3542e0ceadfa8385600bbc8dff46d53106eafa891a1dd50da969db1ce6797d6652a7381399fbd324d3b89ce71a513fe9380e62a1f1e14cecb230d71f17975719e0f327fc2dd063dbf257c1f1318e882ffdd1f2d88c0f5a75284868fe9852bfa724ebe109aba122edcf11294f8a471cfb04b28f19d6410640757a85a991d1eaba59ac536f0f79bfd304a5599ef87dd51713825c2cf697e18e6a5aa253b9745ce55aea15ac4a2c100529b21cbfb1b79304bee8b2be4228e07762705754056358c2918788fb33d550769963de647a7f9ad245020c2e31f72f75f43c54f5d3f187852ef788a49c533bf5ca606bd6a33af34fb667fb776e20d5394839d6a7585de5139c4217bcaaccf4adf953c2a3852aa504dcb1b53b13789749c7d795bcdc3ae6b729cc52092a1fe490890b8be5333e0359a9270a79c186d50ff34d186edf3b17183b11a2319cf2c3435cdfe7b1c1716b7abb5303dd5c7df06cebebd26ed98d154e6a1d8501cfdbc883238af44ed9c6c10da2d018b5712e8494c1972b810abace04e73ea2248c746ff52d31c47247f909c97bf2abb7ae80c9796c29ccb281b09086f7d66295936fd2bb15a32621f02f8a882fcc33896345af73e36312b8cc861af27d344f006c076099432b503d1cef9f9a4b4cbde49a5fc3ac1cacac1f14f5a03a46dc8cf4f97df2e6402756682a68eaf673f12dac705aa693075887908847601b6bc2037c9f71b889b73f4fccedd2da8ac556f18943ed0aeef466d67554146fae57c5c2830b92166437577acb43459aa8f228574b213fdbbb2552adeb139056bec44b51a8112b4879bbbedfb485a0eceb41ffa9a30e83c2a78a11fb0de233c4d0750555110654b1ce975634f0a0625173b8433dc93e345fc9cbe56418ccad08ee895deefbb3e16a4bfb635d4c5c93505de135bc6cd2ba6b4567c83430619035b5b3e5fe66efd3e66e524fbb1553f5e3a02dd3524f9fb7f992352ac88d73829fa3fabb1a494d39e5d7bb991f3060f8ec8dec02a41710da4edff38b822d0c2567a968d8ad69921a7b871f8daea8ecc7d3172e7679e483eccfcb0c504c64b8316de9918ef5367276d81ec74f48737de72ac73cb94a57c7e3f1a0a845b56744f9baaaf66f36583f938bda914b3af0218f74dea293c3b5e8bc9bd90f473e00f75d0b5e37e23e5d5b23ee2cdd67c0beb0867b4cdb9689710bc82ab096e9ba8dbf3d1843d211204df98c25e40a1ac864d1f9ab369eb4e9332f09786304418a567a1a02bb77289ab89c3ab726e7aac891469edefb91726e08681241a8d1b9d0d800f87f8241e577e77f0f5b84dd7340bb1137c32e2a0d23b8ba8925455a14785dd63270ecaa6ffd4a294a8d8c33b756972d5fea264f5d6ae63c923b4039fc6ce2a40cfcbf03ae5c21428c6d341898b086c3a8370c3088342507f2fe87fecb1e839d734eeb3f512cf10a48ad3f922e377fc3410b1c8aa817479244f700012d92333c3609d5fa3d33d4288ded5fe6f79500b2c03f0cd7af72c1ccca8c56e077862cd59086873abc13c8674a58589add02a2955b73d64d1431a5f2c24cc9f026c40d03485651a881afa9a0e6b88a1b37faa91c9c1e03369aa491a6ad4dd6112c263b28e63391ab8b5453d478be21d87b45725857d24bd11cfb539295ac45a3ee19fc9a5c30b7ff47f5557dba1920d456ee4bed4cc7a081c95eb473baebbe338b31818d6bde40c80cb2f7c584e219f699ccf814bd03a75609b863ca89f6245be2fe9655d524cfbe5007990af02cba1155716a39c65448885f2ed745706b80f1add2d6ae325ccc6aa44d8e2686af05e65ccacc186892a8c3d8cde051aa307afdc3462e139b02d86bfc81124caae00551e87dcaca6e6c16247a4901d7122e7519f792336fa1f3567130b8a6a95a8aad2</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      总结
    
    </summary>
    
    
      <category term="生活学习" scheme="https://blog.songuo.tech/categories/%E7%94%9F%E6%B4%BB%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="总结" scheme="https://blog.songuo.tech/tags/%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>分节后，word总页数不为节的总页数</title>
    <link href="https://blog.songuo.tech/p/f7f5ae3a.html"/>
    <id>https://blog.songuo.tech/p/f7f5ae3a.html</id>
    <published>2021-11-30T06:12:00.000Z</published>
    <updated>2021-11-30T07:40:48.124Z</updated>
    
    <content type="html"><![CDATA[<p>选中总页数，鼠标右击，选中编辑域，进入弹出窗口</p><a id="more"></a><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20211130/image-20211130153228038.png" alt="image-20211130153228038"></p><p>在弹出的窗口,点击【域代码】，</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20211130/image-20211130153547063.png" alt="image-20211130153547063"></p><p>将NumPages修改成sectionpages，点击【确定】即可</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20211130/image-20211130153651158.png" alt="image-20211130153651158"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;选中总页数，鼠标右击，选中编辑域，进入弹出窗口&lt;/p&gt;
    
    </summary>
    
    
      <category term="office" scheme="https://blog.songuo.tech/categories/office/"/>
    
    
      <category term="office" scheme="https://blog.songuo.tech/tags/office/"/>
    
  </entry>
  
  <entry>
    <title>nginx反向代理去除tomcat项目名</title>
    <link href="https://blog.songuo.tech/p/23de2d9e.html"/>
    <id>https://blog.songuo.tech/p/23de2d9e.html</id>
    <published>2021-10-21T02:30:00.000Z</published>
    <updated>2021-10-20T07:17:33.613Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen    80;</span><br><span class="line">  server_name crm.xxx.net;</span><br><span class="line">  </span><br><span class="line">  location &#x2F; &#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;192.168.1.216&#x2F;crm&#x2F;;</span><br><span class="line">    proxy_cookie_path &#x2F;crm&#x2F; &#x2F;;</span><br><span class="line">    proxy_set_header  Host  $host;</span><br><span class="line">    proxy_set_header  X-Real-IP  $remote_addr;</span><br><span class="line">    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">  &#125;</span><br><span class="line">  location &#x2F;crm&#x2F;&#123;</span><br><span class="line">    proxy_pass http:&#x2F;&#x2F;192.168.1.216&#x2F;crm&#x2F;;</span><br><span class="line">    proxy_cookie_path &#x2F;crm&#x2F; &#x2F;;</span><br><span class="line">    proxy_set_header  Host  $host;</span><br><span class="line">    proxy_set_header  X-Real-IP  $remote_addr;</span><br><span class="line">    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  listen    80;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  server_name crm.xxx.net;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  location &amp;#x2F; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_pass http:&amp;#x2F;&amp;#x2F;192.168.1.216&amp;#x2F;crm&amp;#x2F;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_cookie_path &amp;#x2F;crm&amp;#x2F; &amp;#x2F;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_set_header  Host  $host;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_set_header  X-Real-IP  $remote_addr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  location &amp;#x2F;crm&amp;#x2F;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_pass http:&amp;#x2F;&amp;#x2F;192.168.1.216&amp;#x2F;crm&amp;#x2F;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_cookie_path &amp;#x2F;crm&amp;#x2F; &amp;#x2F;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_set_header  Host  $host;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_set_header  X-Real-IP  $remote_addr;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="开发经验" scheme="https://blog.songuo.tech/categories/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="nginx" scheme="https://blog.songuo.tech/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>在谷歌浏览器(chrome)里面在线浏览word，excel文件</title>
    <link href="https://blog.songuo.tech/p/fc11f5f9.html"/>
    <id>https://blog.songuo.tech/p/fc11f5f9.html</id>
    <published>2021-09-02T02:30:00.000Z</published>
    <updated>2021-09-03T03:48:07.397Z</updated>
    
    <content type="html"><![CDATA[<p>首先下载离线安装包，是一个crx文件，不需要打开<a id="more"></a></p><p>地址栏输入： chrome://extensions/</p><p>调整到开发者模式，然后将刚刚下载的crx文件拖入到浏览器</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210903/20210127091755861.png" alt="在这里插入图片描述"></p><p>如果没有弹出安装的提示，把浏览器关了多重试几次。</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210903/20210127083952207.png" alt="设置允许控件"></p><p>修改配置，地址栏输入chrome://flags/#enable-nacl<br>将其改成enabled</p><p>重启浏览器</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;首先下载离线安装包，是一个crx文件，不需要打开
    
    </summary>
    
    
      <category term="开发经验" scheme="https://blog.songuo.tech/categories/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="office" scheme="https://blog.songuo.tech/tags/office/"/>
    
  </entry>
  
  <entry>
    <title>nignx文件服务器，添加用户认证</title>
    <link href="https://blog.songuo.tech/p/a346aa4b.html"/>
    <id>https://blog.songuo.tech/p/a346aa4b.html</id>
    <published>2021-08-30T02:30:00.000Z</published>
    <updated>2021-08-30T01:22:42.348Z</updated>
    
    <content type="html"><![CDATA[<p>nginx搭建文件服务器，为了安全起见，但只想部分份能够下载。<a id="more"></a></p><p>Nginx进行用户名密码验证的话是通过ngx_http_auth_basic_module模块实现，该模块可作用范围http，server，location，limit_except，语法如下：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="attribute">auth_basic</span>           <span class="string">"Please input your name"</span>;</span><br><span class="line">    <span class="attribute">auth_basic_user_file</span> /etc/nginx/conf/htpasswd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在conf目录下创建htpasswd文件，文件中添加用户名密码，格式如下</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test:123456</span><br></pre></td></tr></table></figure><p>重启nginx后，访问，效果如下：</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210830/1d481482201251.png" alt="nginxbasicautu.png"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;nginx搭建文件服务器，为了安全起见，但只想部分份能够下载。
    
    </summary>
    
    
      <category term="开发经验" scheme="https://blog.songuo.tech/categories/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="nignx" scheme="https://blog.songuo.tech/tags/nignx/"/>
    
      <category term="文件服务" scheme="https://blog.songuo.tech/tags/%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>lodop打印pdf</title>
    <link href="https://blog.songuo.tech/p/7865609e.html"/>
    <id>https://blog.songuo.tech/p/7865609e.html</id>
    <published>2021-08-20T07:30:00.000Z</published>
    <updated>2021-08-20T03:54:27.836Z</updated>
    
    <content type="html"><![CDATA[<p>参考： <a href="http://demo.clodop.com:8000/c_pdfprint" target="_blank" rel="noopener">http://demo.clodop.com:8000/c_pdfprint</a></p><p>结合jacob转pdf，可实现office文档的在线打印。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;参考： &lt;a href=&quot;http://demo.clodop.com:8000/c_pdfprint&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://demo.clodop.com:8000/c_pdfprint&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;结合jacob转pdf，可实现office文档的在线打印。&lt;/p&gt;

    
    </summary>
    
    
      <category term="开发经验" scheme="https://blog.songuo.tech/categories/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="lodop" scheme="https://blog.songuo.tech/tags/lodop/"/>
    
  </entry>
  
  <entry>
    <title>Windows下使用jacob进行文档操作</title>
    <link href="https://blog.songuo.tech/p/9fe0785f.html"/>
    <id>https://blog.songuo.tech/p/9fe0785f.html</id>
    <published>2021-08-20T02:30:00.000Z</published>
    <updated>2021-08-20T03:54:27.840Z</updated>
    
    <content type="html"><![CDATA[<p>使用jacob进行office文件操作</p><a id="more"></a><p>1.下载jacob相关jar和dll</p><p><a href="https://github.com/freemansoft/jacob-project/releases" target="_blank" rel="noopener">https://github.com/freemansoft/jacob-project/releases</a></p><p>2.将dll放入对应文件夹</p><p>64位windows环境，将dll放到C:\Windows\System32<em>下面</em></p><p>32位windows环境，将dll <em>放到</em>C:\Windows\SysWOW64 下面</p><p>3.pom文件引用相关jar</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jacob<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jacob<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>4.文档操作工具类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLConnection;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.io.FileUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> com.jacob.activeX.ActiveXComponent;</span><br><span class="line"><span class="keyword">import</span> com.jacob.com.ComThread;</span><br><span class="line"><span class="keyword">import</span> com.jacob.com.Dispatch;</span><br><span class="line"><span class="keyword">import</span> com.jacob.com.Variant;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FilenameUtils;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JacobOfficeUtil</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> wdFormatPDF = <span class="number">17</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> xlTypePDF = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ppSaveAsPDF = <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// doc格式</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DOC_FMT = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * docx格式</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DOCX_FMT = <span class="number">12</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    File[] files = <span class="keyword">new</span> File(<span class="string">"E:\\试验项目\\jacob"</span>).listFiles();</span><br><span class="line">    Long start = System.currentTimeMillis();</span><br><span class="line">    List list = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    <span class="keyword">for</span> (File file :files ) &#123;</span><br><span class="line">        <span class="keyword">if</span> (file.isFile())&#123;</span><br><span class="line">          String fileMainName= FileUtil.mainName(file);</span><br><span class="line">          log.info(<span class="string">"处理文件名为&#123;&#125;的文件"</span>,file.getName());</span><br><span class="line">          String filePath = file.getAbsolutePath();</span><br><span class="line">          list.add(filePath);</span><br><span class="line"><span class="comment">//          JacobOfficeUtil.word2PDF(</span></span><br><span class="line"><span class="comment">//              filePath, file.getParent()+File.separator+"pdf"+File.separator+fileMainName+".pdf");</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">"转换共花费&#123;&#125;秒"</span>,(System.currentTimeMillis()-start)/<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    //doc转为docx</span></span><br><span class="line">    <span class="comment">//try &#123;</span></span><br><span class="line">    <span class="comment">//JacobOfficeUtil.convertDocFmt("D:/cod/1.doc", "D:/cod/4.docx", DOCX_FMT);</span></span><br><span class="line">    <span class="comment">//&#125; catch (Exception e) &#123;</span></span><br><span class="line">    <span class="comment">//// TODO Auto-generated catch block</span></span><br><span class="line">    <span class="comment">//e.printStackTrace();</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//合并docx</span></span><br><span class="line">    start = System.currentTimeMillis();</span><br><span class="line">    uniteDoc(list, <span class="string">"E:\\试验项目\\jacob\\合并\\合并.docx"</span>);</span><br><span class="line">    log.info(<span class="string">"共计合并&#123;&#125;个文档，耗时&#123;&#125;秒"</span>,list.size(),(System.currentTimeMillis()-start)/<span class="number">1000</span>);</span><br><span class="line">    start = System.currentTimeMillis();</span><br><span class="line">    JacobOfficeUtil.word2PDF(<span class="string">"E:\\试验项目\\jacob\\合并\\合并.docx"</span>, <span class="string">"E:\\试验项目\\jacob\\合并\\合并.pdf"</span>);</span><br><span class="line">    log.info(<span class="string">"转换文档共计耗时&#123;&#125;秒"</span>,list.size(),(System.currentTimeMillis()-start)/<span class="number">1000</span>);</span><br><span class="line">    <span class="comment">//docx转为htm</span></span><br><span class="line"><span class="comment">//ChageFormat("d:\\cod\\","1.docx");</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">convert2PDF</span><span class="params">(String inputFile, String pdfFile)</span> </span>&#123;</span><br><span class="line">    String suffix = getFileSufix(inputFile);</span><br><span class="line">    File file = <span class="keyword">new</span> File(inputFile);</span><br><span class="line">    <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (suffix.equals(<span class="string">"pdf"</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (suffix.equals(<span class="string">"doc"</span>) || suffix.equals(<span class="string">"docx"</span>) || suffix.equals(<span class="string">"txt"</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> word2PDF(inputFile, pdfFile);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (suffix.equals(<span class="string">"ppt"</span>) || suffix.equals(<span class="string">"pptx"</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> ppt2PDF(inputFile, pdfFile);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (suffix.equals(<span class="string">"xls"</span>) || suffix.equals(<span class="string">"xlsx"</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> excel2PDF(inputFile, pdfFile);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getFileSufix</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> splitIndex = fileName.lastIndexOf(<span class="string">"."</span>);</span><br><span class="line">    <span class="keyword">return</span> fileName.substring(splitIndex + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// word转换为pdf</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">word2PDF</span><span class="params">(String inputFile, String pdfFile)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 打开word应用程序</span></span><br><span class="line">      ActiveXComponent app = <span class="keyword">new</span> ActiveXComponent(<span class="string">"Word.Application"</span>);</span><br><span class="line">      <span class="comment">// 设置word不可见</span></span><br><span class="line">      app.setProperty(<span class="string">"Visible"</span>, <span class="keyword">false</span>);</span><br><span class="line">      <span class="comment">// 获得word中所有打开的文档,返回Documents对象</span></span><br><span class="line">      Dispatch docs = app.getProperty(<span class="string">"Documents"</span>).toDispatch();</span><br><span class="line">      <span class="comment">// 调用Documents对象中Open方法打开文档，并返回打开的文档对象Document</span></span><br><span class="line">      Dispatch doc = Dispatch.call(docs, <span class="string">"Open"</span>, inputFile, <span class="keyword">false</span>, <span class="keyword">true</span>).toDispatch();</span><br><span class="line">      <span class="comment">// 调用Document对象的SaveAs方法，将文档保存为pdf格式</span></span><br><span class="line">      <span class="comment">//Dispatch.call(doc, "SaveAs", pdfFile, wdFormatPDF //word保存为pdf格式宏，值为17 );</span></span><br><span class="line">      Dispatch.call(doc, <span class="string">"ExportAsFixedFormat"</span>, pdfFile, wdFormatPDF);<span class="comment">// word保存为pdf格式宏，值为17</span></span><br><span class="line">      <span class="comment">// 关闭文档</span></span><br><span class="line">      Dispatch.call(doc, <span class="string">"Close"</span>, <span class="keyword">false</span>);</span><br><span class="line">      <span class="comment">// 关闭word应用程序</span></span><br><span class="line">      app.invoke(<span class="string">"Quit"</span>, <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// excel转换为pdf</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">excel2PDF</span><span class="params">(String inputFile, String pdfFile)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      ActiveXComponent app = <span class="keyword">new</span> ActiveXComponent(<span class="string">"Excel.Application"</span>);</span><br><span class="line">      app.setProperty(<span class="string">"Visible"</span>, <span class="keyword">false</span>);</span><br><span class="line">      Dispatch excels = app.getProperty(<span class="string">"Workbooks"</span>).toDispatch();</span><br><span class="line">      Dispatch excel = Dispatch.call(excels, <span class="string">"Open"</span>, inputFile, <span class="keyword">false</span>, <span class="keyword">true</span>).toDispatch();</span><br><span class="line">      Dispatch.call(excel, <span class="string">"ExportAsFixedFormat"</span>, xlTypePDF, pdfFile);</span><br><span class="line">      Dispatch.call(excel, <span class="string">"Close"</span>, <span class="keyword">false</span>);</span><br><span class="line">      app.invoke(<span class="string">"Quit"</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ppt转换为pdf</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">ppt2PDF</span><span class="params">(String inputFile, String pdfFile)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      ActiveXComponent app = <span class="keyword">new</span> ActiveXComponent(<span class="string">"PowerPoint.Application"</span>);</span><br><span class="line">      <span class="comment">// app.setProperty("Visible", msofalse);</span></span><br><span class="line">      Dispatch ppts = app.getProperty(<span class="string">"Presentations"</span>).toDispatch();</span><br><span class="line"></span><br><span class="line">      Dispatch ppt = Dispatch.call(ppts, <span class="string">"Open"</span>, inputFile, <span class="keyword">true</span>, <span class="comment">// ReadOnly</span></span><br><span class="line">          <span class="keyword">true</span>, <span class="comment">// Untitled指定文件是否有标题</span></span><br><span class="line">          <span class="keyword">false</span><span class="comment">// WithWindow指定文件是否可见</span></span><br><span class="line">      ).toDispatch();</span><br><span class="line"></span><br><span class="line">      Dispatch.call(ppt, <span class="string">"SaveAs"</span>, pdfFile, ppSaveAsPDF);</span><br><span class="line"></span><br><span class="line">      Dispatch.call(ppt, <span class="string">"Close"</span>);</span><br><span class="line"></span><br><span class="line">      app.invoke(<span class="string">"Quit"</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//将doc转为docx</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> File <span class="title">convertDocFmt</span><span class="params">(String srcPath, String descPath, <span class="keyword">int</span> fmt)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 实例化ComThread线程与ActiveXComponent</span></span><br><span class="line">    ComThread.InitSTA();</span><br><span class="line">    ActiveXComponent app = <span class="keyword">new</span> ActiveXComponent(<span class="string">"Word.Application"</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 文档隐藏时进行应用操作</span></span><br><span class="line">      app.setProperty(<span class="string">"Visible"</span>, <span class="keyword">new</span> Variant(<span class="keyword">false</span>));</span><br><span class="line">      <span class="comment">// 实例化模板Document对象</span></span><br><span class="line">      Dispatch document = app.getProperty(<span class="string">"Documents"</span>).toDispatch();</span><br><span class="line">      <span class="comment">// 打开Document进行另存为操作</span></span><br><span class="line">      Dispatch doc = Dispatch.invoke(document, <span class="string">"Open"</span>, Dispatch.Method,</span><br><span class="line">          <span class="keyword">new</span> Object[] &#123; srcPath, <span class="keyword">new</span> Variant(<span class="keyword">true</span>), <span class="keyword">new</span> Variant(<span class="keyword">true</span>) &#125;, <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">1</span>]).toDispatch();</span><br><span class="line"></span><br><span class="line">      Dispatch.invoke(doc, <span class="string">"SaveAs"</span>, Dispatch.Method, <span class="keyword">new</span> Object[] &#123; descPath, <span class="keyword">new</span> Variant(fmt) &#125;, <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">1</span>]);</span><br><span class="line">      Dispatch.call(doc, <span class="string">"Close"</span>, <span class="keyword">new</span> Variant(<span class="keyword">false</span>));</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> File(descPath);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// 释放线程与ActiveXComponent</span></span><br><span class="line">      app.invoke(<span class="string">"Quit"</span>, <span class="keyword">new</span> Variant[] &#123;&#125;);</span><br><span class="line">      ComThread.Release();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 合并docx</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">uniteDoc</span><span class="params">(List fileList, String savepaths)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (fileList.size() == <span class="number">0</span> || fileList == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 打开word</span></span><br><span class="line">    ActiveXComponent app = <span class="keyword">new</span> ActiveXComponent(<span class="string">"Word.Application"</span>);<span class="comment">// 启动word</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 设置word不可见 ---也就是设置ActiveXComponent对象的一个属性</span></span><br><span class="line">      app.setProperty(<span class="string">"Visible"</span>, <span class="keyword">new</span> Variant(<span class="keyword">false</span>));</span><br><span class="line">      <span class="comment">// 获得documents对象----Variant。toDispatch()</span></span><br><span class="line">      Object docs = app.getProperty(<span class="string">"Documents"</span>).toDispatch();</span><br><span class="line">      <span class="comment">// 打开第一个文件</span></span><br><span class="line">      <span class="comment">// 功能调用，对ActiveX对象docs的"Open"属性执行Dispatch.Method（Dispatch.Put\Dispatch.Get等）操作，执行后"Open"的值为参数4，参数5为错误参数码常定义为new</span></span><br><span class="line">      <span class="comment">// int[1]，（注：call、get和put方法都是通过该方法实现的）</span></span><br><span class="line">      Object doc = Dispatch.invoke((Dispatch) docs, <span class="comment">// 调用目标</span></span><br><span class="line">          <span class="string">"Open"</span>, Dispatch.Method,</span><br><span class="line">          <span class="keyword">new</span> Object[] &#123; (String) fileList.get(fileList.size()-<span class="number">1</span>), <span class="keyword">new</span> Variant(<span class="keyword">false</span>), <span class="keyword">new</span> Variant(<span class="keyword">true</span>) &#125;, <span class="comment">// 参数4</span></span><br><span class="line">          <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>]).toDispatch();<span class="comment">// 参数5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Dispatch selection1 = Dispatch.get(app, "Selection").toDispatch();</span></span><br><span class="line"><span class="comment">////插入分页符</span></span><br><span class="line"><span class="comment">//Dispatch.call(selection1,  "InsertBreak" ,  new Variant(7) );</span></span><br><span class="line">      <span class="comment">// 追加文件</span></span><br><span class="line">      <span class="comment">// 和上面一样，不过换种通俗的解释：参数1就是这个invoke方法的主题操作对象，参数2就是要对参数1执行的方法的名字，参数3就是参数2这个方法的具体操作;参数4就是一系列的参数;参数5为错误参数码常定义为new</span></span><br><span class="line">      <span class="comment">// int[1]</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; fileList.size()-<span class="number">1</span>; i++) &#123;</span><br><span class="line">        Dispatch.invoke(app.getProperty(<span class="string">"Selection"</span>).toDispatch(), <span class="comment">// 参数1</span></span><br><span class="line">            <span class="string">"insertFile"</span>, <span class="comment">// 参数2</span></span><br><span class="line">            Dispatch.Method, <span class="comment">// 参数3</span></span><br><span class="line">            <span class="keyword">new</span> Object[] &#123; (String) fileList.get(i), <span class="string">""</span>, <span class="keyword">new</span> Variant(<span class="keyword">false</span>), <span class="keyword">new</span> Variant(<span class="keyword">false</span>),</span><br><span class="line">                <span class="keyword">new</span> Variant(<span class="keyword">false</span>) &#125;, <span class="comment">// 参数4</span></span><br><span class="line">            <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>]);<span class="comment">// 参数5</span></span><br><span class="line">        Dispatch selection = Dispatch.get(app, <span class="string">"Selection"</span>).toDispatch();</span><br><span class="line">        <span class="comment">//插入分页符</span></span><br><span class="line">        Dispatch.call(selection,  <span class="string">"InsertBreak"</span> ,  <span class="keyword">new</span> Variant(<span class="number">7</span>) );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 保存新的word文件</span></span><br><span class="line">      Dispatch.invoke((Dispatch) doc, <span class="string">"SaveAs"</span>, Dispatch.Method, <span class="keyword">new</span> Object[] &#123; savepaths, <span class="keyword">new</span> Variant(<span class="number">12</span>) &#125;,</span><br><span class="line">          <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>]);</span><br><span class="line">      Variant f = <span class="keyword">new</span> Variant(<span class="keyword">false</span>);</span><br><span class="line">      Dispatch.call((Dispatch) doc, <span class="string">"Close"</span>, f);<span class="comment">// 该方法和get方法非常类似，他是把"Close"属性赋值给f</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"合并word文件出错.原因:"</span> + e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      app.invoke(<span class="string">"Quit"</span>, <span class="keyword">new</span> Variant[] &#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//转换为html</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">ChageFormat</span><span class="params">(String FolderPath, String FileName)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String FileFormat = <span class="string">""</span>;</span><br><span class="line">    String[] filesplit=FileName.split(<span class="string">"\\."</span>);</span><br><span class="line">    FileFormat =filesplit[filesplit.length-<span class="number">1</span>];<span class="comment">// FileName.substring(FileName.length() - 5, FileName.length());</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (FileFormat.equalsIgnoreCase(<span class="string">"docx"</span>)) &#123;</span><br><span class="line">      String DocFile = FolderPath + <span class="string">"//"</span> + FileName;</span><br><span class="line">      <span class="comment">//System.out.println("word文件路径：" + DocFile);</span></span><br><span class="line">      <span class="comment">// word文件的完整路径</span></span><br><span class="line">      String HtmlFile = DocFile.substring(<span class="number">0</span>, (DocFile.length() - <span class="number">5</span>)) + <span class="string">".html"</span>;</span><br><span class="line">      <span class="comment">//System.out.println("htm文件路径：" + HtmlFile);</span></span><br><span class="line">      <span class="comment">// html文件的完整路径</span></span><br><span class="line">      ActiveXComponent app = <span class="keyword">new</span> ActiveXComponent(<span class="string">"Word.Application"</span>);</span><br><span class="line">      <span class="comment">// 启动word</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        app.setProperty(<span class="string">"Visible"</span>, <span class="keyword">new</span> Variant(<span class="keyword">false</span>));</span><br><span class="line">        <span class="comment">// 设置word程序非可视化运行</span></span><br><span class="line">        Dispatch docs = app.getProperty(<span class="string">"Documents"</span>).toDispatch();</span><br><span class="line">        Dispatch doc = Dispatch</span><br><span class="line">            .invoke(docs, <span class="string">"Open"</span>, Dispatch.Method,</span><br><span class="line">                <span class="keyword">new</span> Object[] &#123; DocFile, <span class="keyword">new</span> Variant(<span class="keyword">true</span>), <span class="keyword">new</span> Variant(<span class="keyword">true</span>) &#125;, <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>])</span><br><span class="line">            .toDispatch();</span><br><span class="line">        <span class="comment">// 打开word文件</span></span><br><span class="line">        Dispatch.invoke(doc, <span class="string">"SaveAs"</span>, Dispatch.Method, <span class="keyword">new</span> Object[] &#123; HtmlFile, <span class="keyword">new</span> Variant(<span class="number">8</span>) &#125;, <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">1</span>]);</span><br><span class="line">        <span class="comment">// 作为htm格式保存文件</span></span><br><span class="line">        Dispatch.call(doc, <span class="string">"Close"</span>, <span class="keyword">new</span> Variant(<span class="keyword">false</span>));</span><br><span class="line">        <span class="comment">// 关闭文件</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        app.invoke(<span class="string">"Quit"</span>, <span class="keyword">new</span> Variant[] &#123;&#125;);</span><br><span class="line">        <span class="comment">// 退出word程序</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 转化完毕</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 判断文件是否存在</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> httpPath</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title">existHttpPath</span><span class="params">(String httpPath)</span></span>&#123;</span><br><span class="line">    URL httpurl = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      httpurl = <span class="keyword">new</span> URL(<span class="keyword">new</span> URI(httpPath).toASCIIString());</span><br><span class="line">      URLConnection urlConnection = httpurl.openConnection();</span><br><span class="line">      <span class="comment">// urlConnection.getInputStream();</span></span><br><span class="line">      Long TotalSize=Long.parseLong(urlConnection.getHeaderField(<span class="string">"Content-Length"</span>));</span><br><span class="line">      <span class="keyword">if</span> (TotalSize &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用jacob进行office文件操作&lt;/p&gt;
    
    </summary>
    
    
      <category term="开发经验" scheme="https://blog.songuo.tech/categories/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="office,jacob" scheme="https://blog.songuo.tech/tags/office-jacob/"/>
    
  </entry>
  
  <entry>
    <title>抓取弹出框的xpath</title>
    <link href="https://blog.songuo.tech/p/42d7f672.html"/>
    <id>https://blog.songuo.tech/p/42d7f672.html</id>
    <published>2021-08-11T01:00:00.000Z</published>
    <updated>2021-08-11T03:02:55.858Z</updated>
    
    <content type="html"><![CDATA[<p>打开chrome浏览器，打开F12开发者工具，点击sources页签，在出现弹框是，点击右侧停止标记停止渲染加载页面你即可。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;打开chrome浏览器，打开F12开发者工具，点击sources页签，在出现弹框是，点击右侧停止标记停止渲染加载页面你即可。&lt;/p&gt;

    
    </summary>
    
    
      <category term="selenium" scheme="https://blog.songuo.tech/categories/selenium/"/>
    
    
      <category term="selenium" scheme="https://blog.songuo.tech/tags/selenium/"/>
    
  </entry>
  
  <entry>
    <title>linux定时删除文件</title>
    <link href="https://blog.songuo.tech/p/e76f239a.html"/>
    <id>https://blog.songuo.tech/p/e76f239a.html</id>
    <published>2021-08-09T02:30:00.000Z</published>
    <updated>2021-08-11T03:02:55.852Z</updated>
    
    <content type="html"><![CDATA[<ol><li>创建shellauto-del-files.sh</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">touch /home/suzhuichang/auto-del-files.sh</span><br><span class="line"></span><br><span class="line">chmod +x auto-del-files.sh</span><br></pre></td></tr></table></figure><p>新建一个可执行文件auto-del-files.sh，并分配可运行权限<a id="more"></a></p><p>2.编辑shell脚本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi auto-del-files.sh</span><br></pre></td></tr></table></figure><p>编辑auto-del-files.sh文件如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">find /home/suzhuichang/importZipDes -mtime +10 -name "*" -exec rm -rf &#123;&#125; \;</span><br></pre></td></tr></table></figure><p>ok，保存退出(:wq)</p><p>3.计划任务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure><p>将auto-del-files.sh执行脚本加入到系统计划任务，到点自动执行.输入：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10 0 * * * /home/suzhuichang/auto-del-files.sh</span><br></pre></td></tr></table></figure><p>这里的设置是每天凌晨0点10分执行auto-del-files.sh文件进行数据清理任务了。</p><p>4.错误 -bash: xxx: /bin/sh^M: bad interpreter: No such file or directory</p><p>使用notepad++打开sh文件，将文件转为Unix(LF) UTF-8格式保存，上传即可。</p><p>参考资料：</p><p><a href="http://c.biancheng.net/view/1092.html" target="_blank" rel="noopener">http://c.biancheng.net/view/1092.html</a></p><p><a href="https://tool.lu/crontab/" target="_blank" rel="noopener">https://tool.lu/crontab/</a></p><p><a href="https://www.cnblogs.com/panie2015/p/8523377.html" target="_blank" rel="noopener">https://www.cnblogs.com/panie2015/p/8523377.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;ol&gt;
&lt;li&gt;创建shellauto-del-files.sh&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;touch /home/suzhuichang/auto-del-files.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chmod +x auto-del-files.sh&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;新建一个可执行文件auto-del-files.sh，并分配可运行权限
    
    </summary>
    
    
      <category term="开发经验" scheme="https://blog.songuo.tech/categories/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="linux" scheme="https://blog.songuo.tech/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>office在线预览以及在线编辑1</title>
    <link href="https://blog.songuo.tech/p/4c4ebf52.html"/>
    <id>https://blog.songuo.tech/p/4c4ebf52.html</id>
    <published>2021-07-01T03:31:00.000Z</published>
    <updated>2021-07-01T03:27:55.213Z</updated>
    
    <content type="html"><![CDATA[<p>做OA或者工作流程的网站中，常常能够看到一些在线Word编辑进行文档处理的功能，这里我开发了一个在线Word编辑插件并且以此为例。<a id="more"></a></p><p><strong>1．NTKO Word在线编辑器介绍：</strong></p><p>NTKO的官方网站：<a href="http://www.ntko.com/" target="_blank" rel="noopener">http://www.ntko.com/</a><br> NTKO OFFICE文档控件是拥有完全自主知识产权的ActiveX控件。使用NTKO Office文档控件，能够在浏览器中直接编辑Word,Excel等Office文档，或者WPS，金山电子表等文档并保存到web服务器。实现文档和电子表格的统一管理。NTKO OFFICE文档控件具有在线编辑，痕迹保留，手写签名，模板套红，安全电子印章[企业版提供]，全屏批注，保存为HTML,MHT,PDF文件等办公自动化系统必备的功能。可以运行在PHP，ASP，JSP，C#，VB.NET，DOMINO等各种web编程语言和服务器。</p><p><strong>2．列出完整的jQuery插件的代码清单：</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br></pre></td><td class="code"><pre><span class="line">jquery.ntko.js</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  @author: Leepy</span></span><br><span class="line"><span class="comment"> *  @date:  2010-12</span></span><br><span class="line"><span class="comment"> *  @descript:  ntko word编辑器JQ插件</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line">(</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123;</span><br><span class="line">        $.ntko = $.ntko || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        $.fn.extend(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//文件类型</span></span><br><span class="line">            fileType: &#123;</span><br><span class="line">                Word: <span class="string">"Word.Document"</span>,</span><br><span class="line">                Excel: <span class="string">"Excel.Sheet"</span>,</span><br><span class="line">                PowerPoint: <span class="string">"PowerPoint.Show"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//弹出窗类型</span></span><br><span class="line">            showDialogType: &#123;</span><br><span class="line">                New: <span class="number">0</span>,</span><br><span class="line">                Open: <span class="number">1</span>,</span><br><span class="line">                Save: <span class="number">2</span>,</span><br><span class="line">                SaveCopy: <span class="number">3</span>,</span><br><span class="line">                Print: <span class="number">4</span>,</span><br><span class="line">                PageSetup: <span class="number">5</span>,</span><br><span class="line">                Properties: <span class="number">6</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//Word信息内容</span></span><br><span class="line">            wordInfo: &#123;</span><br><span class="line">                Start: <span class="number">0</span>,</span><br><span class="line">                End: <span class="number">0</span>,</span><br><span class="line">                Text: <span class="string">"NDOFramer"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//表单设置</span></span><br><span class="line">            formSettings: &#123;</span><br><span class="line">                UploadFileId: <span class="string">"EDITFILE"</span>,</span><br><span class="line">                Data: <span class="string">"savetype=1&amp;fileType="</span>,</span><br><span class="line">                FileName: <span class="string">"demo.doc"</span>,</span><br><span class="line">                FormId: <span class="number">0</span></span><br><span class="line">            &#125;,</span><br><span class="line">            _doc: <span class="literal">null</span>,</span><br><span class="line">            _selection: <span class="literal">null</span>,</span><br><span class="line">            _range: <span class="literal">null</span>,</span><br><span class="line">            <span class="comment">//初始化插件</span></span><br><span class="line">            ntko: <span class="function"><span class="keyword">function</span>(<span class="params">parameters</span>) </span>&#123;</span><br><span class="line">                parameters = parameters || &#123;&#125;;</span><br><span class="line">                <span class="keyword">var</span> ndObj = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">                    ndObj = $.ntko.init(<span class="keyword">this</span>, parameters);</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> ndObj;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//关闭插件</span></span><br><span class="line">            close: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].close();</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//打开文档</span></span><br><span class="line">            open: <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].BeginOpenFromURL(url);   <span class="comment">//第二个参数为只读设置</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//新建Word文档</span></span><br><span class="line">            newWord: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].CreateNew(<span class="keyword">this</span>.fileType.Word);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//新建Excel文档</span></span><br><span class="line">            newExcel: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].CreateNew(<span class="keyword">this</span>.fileType.Excel);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//新建PowerPoint文档</span></span><br><span class="line">            newPowerPoint: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].CreateNew(<span class="keyword">this</span>.fileType.PowerPoint);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//打开本地文档</span></span><br><span class="line">            openLocalFile: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].showdialog(<span class="keyword">this</span>.showDialogType.Open);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//保存到本地</span></span><br><span class="line">            saveLocalFile: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].ActiveDocument.Application.Dialogs(<span class="number">83</span>).Show()</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//保存文档，返回是否保存成功</span></span><br><span class="line">            save: <span class="function"><span class="keyword">function</span>(<span class="params">url, parameters</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> (parameters.formId) !== <span class="string">"undefined"</span>)</span><br><span class="line">                    <span class="keyword">this</span>.formSettings.FormId = parameters.formId;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> (parameters.data) !== <span class="string">"undefined"</span>)</span><br><span class="line">                    <span class="keyword">this</span>.formSettings.Data = parameters.data;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> retHTML = <span class="keyword">this</span>[<span class="number">0</span>].saveToURL(url,    <span class="comment">//提交到的url地址</span></span><br><span class="line">                    <span class="keyword">this</span>.formSettings.UploadFileId,     <span class="comment">//文件域的id，类似&lt;input type=file id=upLoadFile 中的id</span></span><br><span class="line">                    <span class="keyword">this</span>.formSettings.Data,             <span class="comment">//与控件一起提交的参数,savetype参数为要保存的文件格式office,html,pdf。filetype参数保存文件类型</span></span><br><span class="line">                    <span class="keyword">this</span>.formSettings.FileName,         <span class="comment">//上传文件的名称，类似&lt;input type=file 的value</span></span><br><span class="line">                    <span class="keyword">this</span>.formSettings.FormId            <span class="comment">//与控件一起提交的表单id，也可以是form的序列号，这里应该是0.</span></span><br><span class="line">                );</span><br><span class="line">                <span class="keyword">return</span> retHTML;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//下载远程文件</span></span><br><span class="line">            downloadFile: <span class="function"><span class="keyword">function</span>(<span class="params">url, localPath</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].DownloadFile(url, localPath);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//插入本地文档</span></span><br><span class="line">            insertLocalFile: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].ActiveDocument.Application.Dialogs(<span class="number">164</span>).Show();</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//插入文档</span></span><br><span class="line">            insertFile: <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>._doc = <span class="keyword">this</span>[<span class="number">0</span>].ActiveDocument;</span><br><span class="line">                <span class="keyword">this</span>._doc.Activate();</span><br><span class="line">                <span class="comment">//                this._doc.Select();</span></span><br><span class="line">                <span class="comment">//                this._doc.Application.Selection.Select();</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].AddTemplateFromURL(url);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//插入本地图片</span></span><br><span class="line">            insertLocalImage: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].ActiveDocument.Application.Dialogs(<span class="number">163</span>).Show();</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//插入图片</span></span><br><span class="line">            insertImage: <span class="function"><span class="keyword">function</span>(<span class="params">url, type</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].InsertFile(url, type + <span class="number">8</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//插入文本</span></span><br><span class="line">            insertText: <span class="function"><span class="keyword">function</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>._doc = <span class="keyword">this</span>[<span class="number">0</span>].ActiveDocument;</span><br><span class="line">                <span class="keyword">this</span>._doc.Activate();</span><br><span class="line">                <span class="keyword">this</span>._doc.Application.Selection.InsertAfter(text);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//页面设置</span></span><br><span class="line">            setPageSetup: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].showdialog(<span class="keyword">this</span>.showDialogType.PageSetup);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//文档属性设置</span></span><br><span class="line">            setProperty: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].showdialog(<span class="keyword">this</span>.showDialogType.Properties);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//打印</span></span><br><span class="line">            print: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="comment">//                this[0].PrintOut();</span></span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].showdialog(<span class="keyword">this</span>.showDialogType.Print);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//打印预览</span></span><br><span class="line">            printPreview: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].PrintPreview();</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//关闭打印预览</span></span><br><span class="line">            printExit: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].PrintPreviewExit();</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//隐藏工具栏</span></span><br><span class="line">            hideToolbar: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].Activate(<span class="literal">false</span>);</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].Toolbars = <span class="literal">false</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//显示工具栏</span></span><br><span class="line">            showToolbar: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].Activate(<span class="literal">false</span>);</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].Toolbars = <span class="literal">true</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//隐藏菜单栏</span></span><br><span class="line">            hideMenubar: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].Activate(<span class="literal">false</span>);</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].Menubar = <span class="literal">false</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//显示菜单栏</span></span><br><span class="line">            showMenubar: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].Activate(<span class="literal">false</span>);</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].Menubar = <span class="literal">true</span>;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//获取或设置窗口高度</span></span><br><span class="line">            height: <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> (arg) !== <span class="string">"undefined"</span>) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.css(<span class="string">"height"</span>,arg);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">this</span>.css(<span class="string">"height"</span>); ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//获取或设置窗口宽度</span></span><br><span class="line">            width: <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> (arg) !== <span class="string">"undefined"</span>) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.css(<span class="string">"width"</span>, arg);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">this</span>.css(<span class="string">"width"</span>); ;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//删除本地路径，如c:\\1.doc</span></span><br><span class="line">            deleteLocalFile: <span class="function"><span class="keyword">function</span>(<span class="params">localPath</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].DeleteLocalFile(localPath);</span><br><span class="line">            &#125;,</span><br><span class="line">            showView: <span class="function"><span class="keyword">function</span>(<span class="params">showViewType</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].Activate(<span class="literal">false</span>);</span><br><span class="line">                <span class="keyword">this</span>[<span class="number">0</span>].ActiveDocument.ActiveWindow.View = showViewType;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//添加本地附加文件</span></span><br><span class="line">            <span class="comment">//            addLocalFile: function(fileID,locaPath) &#123;</span></span><br><span class="line">            <span class="comment">//                this[0].HttpAddPostFile(fileID, locaPath);</span></span><br><span class="line">            <span class="comment">//            &#125;,</span></span><br><span class="line">            <span class="comment">//            hostName: function() &#123;</span></span><br><span class="line">            <span class="comment">//                return this[0].HostName;</span></span><br><span class="line">            <span class="comment">//            &#125;,</span></span><br><span class="line">            <span class="comment">//            documentFullName: function() &#123;</span></span><br><span class="line">            <span class="comment">//                return this[0].DocumentFullName;</span></span><br><span class="line">            <span class="comment">//            &#125;,</span></span><br><span class="line">            <span class="comment">//            caption: function() &#123;</span></span><br><span class="line">            <span class="comment">//                return this[0].Caption;</span></span><br><span class="line">            <span class="comment">//            &#125;,</span></span><br><span class="line">            <span class="comment">//            track: function() &#123;</span></span><br><span class="line">            <span class="comment">//                this[0].SetCurrUserName("liping");</span></span><br><span class="line">            <span class="comment">//                this[0].SetTrackRevisions(1);</span></span><br><span class="line">            <span class="comment">//            &#125;,</span></span><br><span class="line">            <span class="comment">//            showTrack: function() &#123;</span></span><br><span class="line">            <span class="comment">//                this[0].ShowRevisions(1);</span></span><br><span class="line">            <span class="comment">//                this[0].ShowView(0);</span></span><br><span class="line">            <span class="comment">//            &#125;,</span></span><br><span class="line">            <span class="comment">//是否只读</span></span><br><span class="line">            isReadOnly: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>[<span class="number">0</span>].IsReadOnly;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//文档是否已做修改</span></span><br><span class="line">            isDirty: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> !<span class="keyword">this</span>[<span class="number">0</span>].ActiveDocument.Saved;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//获取文档所有内容，返回该Word文档内容Json</span></span><br><span class="line">            range: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>._doc = <span class="keyword">this</span>[<span class="number">0</span>].ActiveDocument;</span><br><span class="line">                <span class="keyword">this</span>._doc.Activate();</span><br><span class="line">                <span class="keyword">this</span>._range = <span class="keyword">this</span>._doc.Range();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">this</span>.wordInfo.Start = <span class="keyword">this</span>._range.Start;</span><br><span class="line">                <span class="keyword">this</span>.wordInfo.End = <span class="keyword">this</span>._range.End;</span><br><span class="line">                <span class="keyword">this</span>.wordInfo.Text = <span class="keyword">this</span>._doc.Range(<span class="keyword">this</span>._range.Start, <span class="keyword">this</span>._range.End).Text;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.wordInfo;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//选中文档所有内容，返回该Word文档内容Json</span></span><br><span class="line">            select: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>._doc = <span class="keyword">this</span>[<span class="number">0</span>].ActiveDocument;</span><br><span class="line">                <span class="keyword">this</span>._doc.Activate();</span><br><span class="line">                <span class="keyword">this</span>._doc.Select();</span><br><span class="line">                <span class="keyword">this</span>._selection = <span class="keyword">this</span>._doc.Application.Selection;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">this</span>.wordInfo.Start = <span class="keyword">this</span>._selection.Start;</span><br><span class="line">                <span class="keyword">this</span>.wordInfo.End = <span class="keyword">this</span>._selection.End;</span><br><span class="line">                <span class="keyword">this</span>.wordInfo.Text = <span class="keyword">this</span>._doc.Range(<span class="keyword">this</span>._selection.Start, <span class="keyword">this</span>._selection.End).Text;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.wordInfo;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//取消选中内容</span></span><br><span class="line">            unselect: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>._selection != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">this</span>._selection.Start = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">this</span>._selection.End = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">this</span>._selection = <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            replace: <span class="function"><span class="keyword">function</span>(<span class="params">text, start, end</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//                alert(this._doc.Range(start,end).Text);</span></span><br><span class="line">                <span class="keyword">this</span>._doc.Range(start, end).Text = text;</span><br><span class="line">                <span class="comment">//                alert(this._doc.range(this.wordInfo.Starti,this.wordInfo.End).Text);</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//清除文本</span></span><br><span class="line">            clear: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> wordDoc = <span class="keyword">this</span>[<span class="number">0</span>].ActiveDocument;</span><br><span class="line">                wordDoc.Activate();</span><br><span class="line">                wordDoc.Select();</span><br><span class="line">                <span class="keyword">var</span> wordSelection = wordDoc.Application.Selection;</span><br><span class="line">                wordDoc.Range(wordSelection.Start, wordSelection.End).Text = <span class="string">""</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        $.extend($.ntko,</span><br><span class="line">            &#123;</span><br><span class="line">                settings:</span><br><span class="line">                &#123;</span><br><span class="line">                    folder: <span class="string">""</span>,</span><br><span class="line">                    width: <span class="string">"700px"</span>,</span><br><span class="line">                    height: <span class="string">"500px"</span>,</span><br><span class="line">                    id: <span class="string">"OFRAMER_"</span> + <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(),</span><br><span class="line">                    isToolbar: <span class="literal">true</span>,</span><br><span class="line">                    isMenubar: <span class="literal">true</span>,</span><br><span class="line">                    failed: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                init: <span class="function"><span class="keyword">function</span>(<span class="params">obj, parameters</span>) </span>&#123;</span><br><span class="line">                    <span class="comment">//赋值参数</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">typeof</span> (parameters.folder) !== <span class="string">"undefined"</span>)</span><br><span class="line">                        <span class="keyword">this</span>.settings.folder = parameters.folder;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">typeof</span> (parameters.width) !== <span class="string">"undefined"</span>)</span><br><span class="line">                        <span class="keyword">this</span>.settings.width = parameters.width;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">typeof</span> (parameters.height) !== <span class="string">"undefined"</span>)</span><br><span class="line">                        <span class="keyword">this</span>.settings.height = parameters.height;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">typeof</span> (parameters.id) !== <span class="string">"undefined"</span>)</span><br><span class="line">                        <span class="keyword">this</span>.settings.id = parameters.id;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">typeof</span> (parameters.isToolbar) !== <span class="string">"undefined"</span>)</span><br><span class="line">                        <span class="keyword">this</span>.settings.isToolbar = parameters.isToolbar;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">typeof</span> (parameters.isMenubar) !== <span class="string">"undefined"</span>)</span><br><span class="line">                        <span class="keyword">this</span>.settings.isMenubar = parameters.isMenubar;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">typeof</span> (parameters.failed) !== <span class="string">"undefined"</span>)</span><br><span class="line">                        <span class="keyword">this</span>.settings.failed = parameters.failed || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//构造插件Html</span></span><br><span class="line">                    <span class="keyword">this</span>._createHTML(obj);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">var</span> acxId = <span class="keyword">this</span>.settings.id;</span><br><span class="line">                    <span class="keyword">var</span> acxJQjery = <span class="literal">null</span>;</span><br><span class="line">                    <span class="keyword">var</span> failed = <span class="keyword">this</span>.settings.failed;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//判断是否安装了word编辑器插件</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="built_in">document</span>.getElementById(acxId).Close();</span><br><span class="line">                        acxJQjery = $(<span class="string">"#"</span> + acxId);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                        failed(e);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> acxJQjery;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">//构造插件Html</span></span><br><span class="line">                _createHTML: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">                    $(obj).html(</span><br><span class="line">                        <span class="keyword">this</span>._stringFormat(<span class="string">"&lt;object classid=\"clsid:A39F1330-3322-4a1d-9BF0-0BA2BB90E970\" codebase=\"&#123;0&#125;/officecontrol.cab#version=5,0,0,6\""</span> +</span><br><span class="line">                        <span class="string">"id=\"&#123;1&#125;\" width=\"&#123;2&#125;\" height=\"&#123;3&#125;\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"wmode\" value=\"transparent\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"_ExtentX\" value=\"16960\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"_ExtentY\" value=\"13600\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"BorderColor\" value=\"-2147483632\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"BackColor\" value=\"-2147483643\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"ForeColor\" value=\"-2147483640\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"TitlebarColor\" value=\"-2147483635\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"TitlebarTextColor\" value=\"-2147483634\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"BorderStyle\" value=\"0\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"Titlebar\" value=\"0\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"Statusbar\" value=\"0\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"Toolbars\" value=\"&#123;4&#125;\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"Menubar\" value=\"&#123;5&#125;\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"_ExtentX\" VALUE=\"18071\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"_ExtentY\" VALUE=\"20981\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"IsShowToolMenu\" VALUE=\"1\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"IsNoCopy\" VALUE=\"0\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"IsHiddenOpenURL\" VALUE=\"0\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"MaxUploadSize\" VALUE=\"0\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"FileNew\" VALUE=\"-1\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"FileOpen\" VALUE=\"-1\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"FileClose\" VALUE=\"-1\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"FileSave\" VALUE=\"-1\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"FileSaveAs\" VALUE=\"-1\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"FilePrint\" VALUE=\"-1\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"FilePrintPreview\" VALUE=\"-1\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"FilePageSetup\" VALUE=\"-1\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"FileProperties\" VALUE=\"-1\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"IsStrictNoCopy\" VALUE=\"0\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"IsUseUTF8URL\" VALUE=\"0\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"MenubarColor\" VALUE=\"-2147483643\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"IsUseControlAgent\" VALUE=\"0\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"IsUseUTF8Data\" VALUE=\"0\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"IsSaveDocExtention\" VALUE=\"0\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"IsDirectConnect\" VALUE=\"0\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"SignCursorType\" VALUE=\"0\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"IsResetToolbarsOnOpen\" VALUE=\"0\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;param name=\"IsSaveDataIfHasVDS\" VALUE=\"0\"&gt;"</span> +</span><br><span class="line">                        <span class="string">"&lt;/object&gt;"</span>,</span><br><span class="line">                        <span class="keyword">this</span>.settings.folder,</span><br><span class="line">                        <span class="keyword">this</span>.settings.id,</span><br><span class="line">                        <span class="keyword">this</span>.settings.width,</span><br><span class="line">                        <span class="keyword">this</span>.settings.height,</span><br><span class="line">                        <span class="keyword">this</span>.settings.isToolbar + <span class="string">""</span> == <span class="string">"true"</span> ? <span class="string">"1"</span> : <span class="string">"0"</span>,</span><br><span class="line">                        <span class="keyword">this</span>.settings.isMenubar + <span class="string">""</span> == <span class="string">"true"</span> ? <span class="string">"1"</span> : <span class="string">"0"</span></span><br><span class="line">                        ));</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">//string格式化构造器</span></span><br><span class="line">                _stringFormat: <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> args = <span class="built_in">arguments</span>;</span><br><span class="line">                    <span class="keyword">return</span> str.replace(<span class="regexp">/\&#123;(\d+)\&#125;/g</span>,</span><br><span class="line">                        <span class="function"><span class="keyword">function</span>(<span class="params">m, i</span>) </span>&#123;</span><br><span class="line">                            <span class="keyword">return</span> args[<span class="built_in">parseInt</span>(i) + <span class="number">1</span>];</span><br><span class="line">                        &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">)(jQuery);</span><br></pre></td></tr></table></figure><p><strong>3**</strong>．这里要注意几个问题，**首先在保存文档到远程服务器的时候，可以使用aspx页面或者ashx页面去处理。</p><p>具体调用的代码：jqObj.save(“process.aspx?action=test&amp;data=demo”, { formId: “formeditor” });<br>可以发现我这里有个formId的参数，这个是因为我必须把Word插件必须放在Form标签中，这样在POST数据，也就是文件流的时候有用。<br> 而在process.aspx页面中，的具体代码实现为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">protected void Page_Load(object sender, EventArgs e)</span><br><span class="line">    &#123;</span><br><span class="line">        Response.ContentEncoding &#x3D; Encoding.GetEncoding(&quot;GB2312&quot;);</span><br><span class="line">        string action &#x3D; Request.QueryString[&quot;action&quot;] ?? &quot;&quot;;</span><br><span class="line">        switch (action)</span><br><span class="line">        &#123;</span><br><span class="line">            case &quot;test&quot;:</span><br><span class="line">                Test();     &#x2F;&#x2F;测试保存数据</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void Test()</span><br><span class="line">    &#123;</span><br><span class="line">        string data &#x3D; Request.QueryString[&quot;data&quot;] ?? &quot;&quot;;</span><br><span class="line">        HttpFileCollection files &#x3D; Request.Files;</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            if (files.Count &gt; 0)</span><br><span class="line">            &#123;</span><br><span class="line">                HttpPostedFile file &#x3D; files[0];</span><br><span class="line"></span><br><span class="line">                string fileName &#x3D; Server.MapPath(String.Format(&quot;~&#x2F;output&#x2F;&#123;0&#125;_&#123;1&#125;.doc&quot;, data, Guid.NewGuid()));</span><br><span class="line"></span><br><span class="line">                file.SaveAs(fileName);</span><br><span class="line"></span><br><span class="line">                Response.Write(String.Format(&quot;保存附件“&#123;0&#125;”成功！\r\n返回测试数据：&#123;1&#125;&quot;, fileName, data));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        catch</span><br><span class="line">        &#123;</span><br><span class="line">            Response.Write(&quot;有异常&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>其中，一定要记得写Response.ContentEncoding = Encoding.GetEncoding(“GB2312”);这段代码，如果没有写，返回的中文会出现乱码的情况。我们通过HttpFileCollection files = Request.Files;方式可以取得一个POST文件流。</p><p>在第一次使用该插件的时候，首先必须进行安装，您可以通过下载一个Word编辑器插件安装包.rar包，来安装插件，包里面包含相关的批处理操作，大家自己可以试试。</p><p>[下载地址]:</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;做OA或者工作流程的网站中，常常能够看到一些在线Word编辑进行文档处理的功能，这里我开发了一个在线Word编辑插件并且以此为例。
    
    </summary>
    
    
      <category term="开发经验" scheme="https://blog.songuo.tech/categories/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="onlineoffice" scheme="https://blog.songuo.tech/tags/onlineoffice/"/>
    
  </entry>
  
  <entry>
    <title>office在线预览以及在线编辑</title>
    <link href="https://blog.songuo.tech/p/28c57c36.html"/>
    <id>https://blog.songuo.tech/p/28c57c36.html</id>
    <published>2021-07-01T03:30:00.000Z</published>
    <updated>2021-07-01T03:22:35.856Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://gitee.com/freshways/dsoframer" target="_blank" rel="noopener">https://gitee.com/freshways/dsoframer</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://gitee.com/freshways/dsoframer&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://gitee.com/freshways/dsoframer&lt;/a&gt;&lt;/p&gt;

    
    </summary>
    
    
      <category term="开发经验" scheme="https://blog.songuo.tech/categories/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="onlineoffice" scheme="https://blog.songuo.tech/tags/onlineoffice/"/>
    
  </entry>
  
  <entry>
    <title>使用IEXPress.exe工具制作CAB包</title>
    <link href="https://blog.songuo.tech/p/55d5d9b.html"/>
    <id>https://blog.songuo.tech/p/55d5d9b.html</id>
    <published>2021-07-01T02:30:00.000Z</published>
    <updated>2021-07-01T03:22:35.878Z</updated>
    
    <content type="html"><![CDATA[<p>Internet软件分发单位是“软件包”，它由包含.INF文件或软件分发.OSD文件（或两者都包括）的.CAB文件所组成。一个分发单位也可以包含软件组件，如ActiveX控件，DLL文件等。在制作CAB文件时，可以使用Windows自带的工具IEXPress.exe，该工具位于（C：\windows\system32）目录下。<a id="more"></a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Internet软件分发单位是“软件包”，它由包含.INF文件或软件分发.OSD文件（或两者都包括）的.CAB文件所组成。一个分发单位也可以包含软件组件，如ActiveX控件，DLL文件等。在制作CAB文件时，可以使用Windows自带的工具IEXPress.exe，该工具位于（C：\windows\system32）目录下。
    
    </summary>
    
    
      <category term="开发经验" scheme="https://blog.songuo.tech/categories/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="onlineoffice" scheme="https://blog.songuo.tech/tags/onlineoffice/"/>
    
  </entry>
  
  <entry>
    <title>selenium执行js的注意事项</title>
    <link href="https://blog.songuo.tech/p/15a3b02e.html"/>
    <id>https://blog.songuo.tech/p/15a3b02e.html</id>
    <published>2021-07-01T01:00:00.000Z</published>
    <updated>2021-07-01T01:05:48.789Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-传参注意事项"><a href="#1-传参注意事项" class="headerlink" title="1.传参注意事项"></a>1.传参注意事项</h2><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String js = <span class="string">"var attachments = arguments[0];\n"</span> +</span><br><span class="line">    <span class="string">"var fjlx = arguments[1];\n"</span> +</span><br><span class="line">    <span class="string">"var data = arguments[2];\n"</span> +</span><br><span class="line">    <span class="string">"function addFileByjs(attachments,fjlx,data)&#123;\n"</span> +</span><br><span class="line">    <span class="string">"console.log(attachments);"</span> +</span><br><span class="line">    <span class="string">"&#125;\n"</span> +</span><br><span class="line">    <span class="string">"addFileByjs(attachments,fjlx,data);"</span>;</span><br><span class="line">((JavascriptExecutor) browser).executeScript(js,attachments,fjlx,data);</span><br></pre></td></tr></table></figure><p>​    executeScript(String var1, Object… var2)支持传参，参数在js中使用arguments[i]进行接收。arguments[i]必须放置在最外层，放置在函数中会无法赋值。</p><h2 id="2-调用本地js文件执行js函数的示例"><a href="#2-调用本地js文件执行js函数的示例" class="headerlink" title="2.调用本地js文件执行js函数的示例"></a>2.调用本地js文件执行js函数的示例</h2><p>我们要在Java中执行JavaScriptMethods.js中的execute(s1,s2)方法，JavaScriptMethods.js文件内容如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params">s1, s2</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> s1 + s2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>首先需要定义一个接口，这个接口中给出与要执行的JavaScript方法一样的方法签名，我们定义接口Methods，它的内容如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 接口中的方法签名必须与要执行的JavaScript方法一致</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Methods</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">(String s1,String s2)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，就可以用脚本引擎执行JavaScriptMethods.js中execute(s1,s2)方法了，具体内容写在下面的ExecuteScript类中的：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> javax.script.Invocable;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptEngine;</span><br><span class="line"><span class="keyword">import</span> javax.script.ScriptEngineManager;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecuteScript</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    ScriptEngineManager manager = <span class="keyword">new</span> ScriptEngineManager();</span><br><span class="line">    ScriptEngine engine = manager.getEngineByName(<span class="string">"js"</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      String path = ExecuteScript.class.getResource("").getPath();</span><br><span class="line">      System.out.println(path);</span><br><span class="line">      <span class="comment">// FileReader的参数为所要执行的js文件的路径</span></span><br><span class="line">      engine.eval(<span class="keyword">new</span> FileReader(path + <span class="string">"JavaScriptMethods.js"</span>));</span><br><span class="line">      <span class="keyword">if</span> (engine <span class="keyword">instanceof</span> Invocable) &#123;</span><br><span class="line">        Invocable invocable = (Invocable) engine;</span><br><span class="line">        Methods executeMethod = invocable.getInterface(Methods<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(executeMethod.execute(<span class="string">"hello"</span>, <span class="string">" world"</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;1-传参注意事项&quot;&gt;&lt;a href=&quot;#1-传参注意事项&quot; class=&quot;headerlink&quot; title=&quot;1.传参注意事项&quot;&gt;&lt;/a&gt;1.传参注意事项&lt;/h2&gt;
    
    </summary>
    
    
      <category term="selenium" scheme="https://blog.songuo.tech/categories/selenium/"/>
    
    
      <category term="selenium" scheme="https://blog.songuo.tech/tags/selenium/"/>
    
  </entry>
  
  <entry>
    <title>selenium与http结合实现附件上传</title>
    <link href="https://blog.songuo.tech/p/976dcb4a.html"/>
    <id>https://blog.songuo.tech/p/976dcb4a.html</id>
    <published>2021-07-01T00:42:00.000Z</published>
    <updated>2021-07-01T01:05:48.782Z</updated>
    
    <content type="html"><![CDATA[<p>背景：</p><p>​    项目中需要进行多个多附件上传，且需要保证每个附件都进行上传，缺少一个附件也不能进行提交操作。这样通过sendkey的方式无法判断上传完成的时机，进行附件上传成功与否的判断就比较复杂。在此情况下，想到了通过selenium和http结合的方式进行附件处理，保证表单所有附件都正确上传后再进行表单提交。</p><p>思路：</p><p>1.获取附件上传链接</p><p>2.获取附件上传所需要的cookie以及参数</p><p>3.进行附件上传</p><p>4.查看上传成功后的处理，执行js进行处理</p><a id="more"></a><p>代码如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取cookies</span></span><br><span class="line">Set&lt;Cookie&gt; cookieSet = browser.manage().getCookies();</span><br><span class="line">HttpCookie[] cookies = <span class="keyword">new</span> HttpCookie[cookieSet.size()];</span><br><span class="line">StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"><span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(Cookie cookie:cookieSet)&#123;</span><br><span class="line">    cookies[index]=<span class="keyword">new</span> HttpCookie(cookie.getName(),cookie.getValue());</span><br><span class="line">    stringBuilder.append(cookie.getName())</span><br><span class="line">        .append(<span class="string">"="</span>)</span><br><span class="line">        .append(cookie.getValue())</span><br><span class="line">        .append(<span class="string">";"</span>)</span><br><span class="line">        ;</span><br><span class="line">    index++;</span><br><span class="line">&#125;</span><br><span class="line">String cookiesStr = stringBuilder.substring(<span class="number">0</span>,stringBuilder.length()-<span class="number">1</span>);</span><br><span class="line"><span class="comment">//调用http接口进行附件上传</span></span><br><span class="line">String result = HttpUtil.createPost(<span class="string">""</span>)</span><br><span class="line">    .cookie(cookies)</span><br><span class="line">    .header(Header.COOKIE,cookiesStr)</span><br><span class="line">    .header(Header.HOST,<span class="string">"ssfw.gdcourts.gov.cn"</span>)</span><br><span class="line">    .form(<span class="string">"file"</span>,<span class="keyword">new</span> File(<span class="string">""</span>))</span><br><span class="line">    .execute()</span><br><span class="line">    .body();</span><br><span class="line"><span class="comment">//获取执行结果</span></span><br><span class="line">JSONObject data = JSON.parseObject(result);</span><br><span class="line"><span class="comment">//判断上传是否成功并进行处理</span></span><br><span class="line"><span class="keyword">if</span> (!data.getBoolean(<span class="string">"success"</span>))&#123;</span><br><span class="line">log.info(<span class="string">"上传失败"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//判断是否成功</span></span><br><span class="line">    <span class="comment">//进行js处理</span></span><br><span class="line">    String attachments = <span class="string">""</span>;</span><br><span class="line">    String fjlx = <span class="string">""</span>;</span><br><span class="line">    String js = <span class="string">"var attachments = arguments[0];\n"</span> +</span><br><span class="line">    <span class="string">"var fjlx = arguments[1];\n"</span> +</span><br><span class="line">    <span class="string">"var data = arguments[2];\n"</span> +</span><br><span class="line">    <span class="string">"function addFileByjs()&#123;\n"</span> +</span><br><span class="line">    <span class="string">"\tif($.trim(data.fjList)!='')&#123;\n"</span> +</span><br><span class="line">    <span class="string">"\t\tvar fjpdf = \"1\";\n"</span> +</span><br><span class="line">    <span class="string">"\t\tfor(var i=0;i&lt;data.fjList.length;i++)&#123;\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\tvar fj = data.fjList[i];\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\tvar suffix = fj.fjmc.substring(fj.fjmc.lastIndexOf('.')+1);\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\tif(suffix == 'pdf')&#123;\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\t\tfjpdf = '2';\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\t&#125;\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\tvar len = $('#'+attachments).find(\".attachment_cls\").length+1;\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\tvar mc = W21Json[fjlx];\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\t//替换特殊字符\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\tvar fjmcTmp = filterSpecialChar(fj.fjmc);\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\tvar zjmc = mc+\"_\"+len+\"(\"+fjmcTmp+\")\";\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\tvar clone = $(\"#attachment_div\").clone(true);\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\tclone.removeAttr(\"id\");\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\tclone.find(\".zjxxs_fjmc\").attr(&#123;\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\t\t\"href\":\t\"javascript:void(0);\",\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\t\t\"onclick\":\"funClxxUpload_wzh(this,'\"+fjm+\"');\",\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\t\t\"htitle\": zjmc,\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\t\t\"fjmc\":fjmcTmp\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\t&#125;).append(zjmc);\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\tclone.find(\"input[name='zjxxs.fjid']\").val(fj.fjid);\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\tclone.find(\"input[name='zjxxs.lx']\").val(fjlx);\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\tclone.find(\"input[name='zjxxs.zjmc']\").val(zjmc);\n"</span> +</span><br><span class="line">    <span class="string">"\t\t\tclone.appendTo(\"#\"+attachments);\n"</span> +</span><br><span class="line">                    <span class="string">"\t\t&#125;\n"</span> +</span><br><span class="line">                    <span class="string">"\t&#125;\n"</span> +</span><br><span class="line">                    <span class="string">"&#125;\n"</span> +</span><br><span class="line">                    <span class="string">"addFileByjs();"</span>;</span><br><span class="line">((JavascriptExecutor) browser).executeScript(js,attachments,fjlx,data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>executeScript调用js的注意事项见下节内容</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;背景：&lt;/p&gt;
&lt;p&gt;​    项目中需要进行多个多附件上传，且需要保证每个附件都进行上传，缺少一个附件也不能进行提交操作。这样通过sendkey的方式无法判断上传完成的时机，进行附件上传成功与否的判断就比较复杂。在此情况下，想到了通过selenium和http结合的方式进行附件处理，保证表单所有附件都正确上传后再进行表单提交。&lt;/p&gt;
&lt;p&gt;思路：&lt;/p&gt;
&lt;p&gt;1.获取附件上传链接&lt;/p&gt;
&lt;p&gt;2.获取附件上传所需要的cookie以及参数&lt;/p&gt;
&lt;p&gt;3.进行附件上传&lt;/p&gt;
&lt;p&gt;4.查看上传成功后的处理，执行js进行处理&lt;/p&gt;
    
    </summary>
    
    
      <category term="selenium" scheme="https://blog.songuo.tech/categories/selenium/"/>
    
    
      <category term="selenium" scheme="https://blog.songuo.tech/tags/selenium/"/>
    
  </entry>
  
  <entry>
    <title>使用Maven将Jar包打到本地仓库</title>
    <link href="https://blog.songuo.tech/p/baceea9c.html"/>
    <id>https://blog.songuo.tech/p/baceea9c.html</id>
    <published>2021-06-23T06:30:00.000Z</published>
    <updated>2021-06-23T06:36:45.464Z</updated>
    
    <content type="html"><![CDATA[<p>Maven 执行命令</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Dfile：JAR 包的路径</span></span><br><span class="line"><span class="comment">#DgroupId：groupId(随便填)</span></span><br><span class="line"><span class="comment">#DartifactId：artifactId(随便填)</span></span><br><span class="line"><span class="comment">#Dversion：版本号(随便填)</span></span><br><span class="line"></span><br><span class="line">mvn install:<span class="built_in">install-file</span> <span class="literal">-Dfile</span>=C:\lib\jasperreports<span class="literal">-fonts</span><span class="literal">-5</span>.<span class="number">6.0</span>.jar <span class="literal">-DgroupId</span>=org.ireport <span class="literal">-DartifactId</span>=jasperreports<span class="literal">-fonts</span> <span class="literal">-Dversion</span>=<span class="number">5.6</span>.<span class="number">0</span> <span class="literal">-Dpackaging</span>=jar</span><br></pre></td></tr></table></figure><p>Pom.xml  对应上方你填写的名称</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.xxxxx<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xxxxxx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>xxxx<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Maven 执行命令&lt;/p&gt;
&lt;figure class=&quot;highlight powershell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#Dfile：JAR 包的路径&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#DgroupId：groupId(随便填)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#DartifactId：artifactId(随便填)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#Dversion：版本号(随便填)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mvn install:&lt;span class=&quot;built_in&quot;&gt;install-file&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;-Dfile&lt;/span&gt;=C:\lib\jasperreports&lt;span class=&quot;literal&quot;&gt;-fonts&lt;/span&gt;&lt;span class=&quot;literal&quot;&gt;-5&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;6.0&lt;/span&gt;.jar &lt;span class=&quot;literal&quot;&gt;-DgroupId&lt;/span&gt;=org.ireport &lt;span class=&quot;literal&quot;&gt;-DartifactId&lt;/span&gt;=jasperreports&lt;span class=&quot;literal&quot;&gt;-fonts&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;-Dversion&lt;/span&gt;=&lt;span class=&quot;number&quot;&gt;5.6&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;-Dpackaging&lt;/span&gt;=jar&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;Pom.xml  对应上方你填写的名称&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.xxxxx&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;xxxxxx&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;xxxx&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

    
    </summary>
    
    
      <category term="开发经验" scheme="https://blog.songuo.tech/categories/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="maven" scheme="https://blog.songuo.tech/tags/maven/"/>
    
  </entry>
  
  <entry>
    <title>Word如何调整文字宽度</title>
    <link href="https://blog.songuo.tech/p/420f92f6.html"/>
    <id>https://blog.songuo.tech/p/420f92f6.html</id>
    <published>2021-06-18T06:12:00.000Z</published>
    <updated>2021-06-21T01:54:46.251Z</updated>
    
    <content type="html"><![CDATA[<ol><li><p>打开文档，我们发现内容参差不齐：<a id="more"></a></p><p><img src="https://exp-picture.cdn.bcebos.com/fdb4f00d3aceaad75de0a151eee7340f6578b822.jpg?x-bce-process=image%2Fresize%2Cm_lfit%2Cw_500%2Climit_1%2Fquality%2Cq_80" alt="Word如何调整文字宽度"></p></li><li><p>选取需要排版的文字，找到“开始”下方“调整宽度”</p><p><img src="https://exp-picture.cdn.bcebos.com/2083a5d6e1d06de8a1ea2b96ca93cee8b104ac22.jpg?x-bce-process=image%2Fresize%2Cm_lfit%2Cw_500%2Climit_1%2Fquality%2Cq_80" alt="Word如何调整文字宽度"></p></li><li><p>进入设置界面，一般按照你最大的文字宽度设置字符距离：</p><p><img src="https://exp-picture.cdn.bcebos.com/16d8f72abab8424023756ea77ac595ee40c19e22.jpg?x-bce-process=image%2Fresize%2Cm_lfit%2Cw_500%2Climit_1%2Fquality%2Cq_80" alt="Word如何调整文字宽度"></p></li><li><p>达到预期的排版效果：</p><p><img src="https://exp-picture.cdn.bcebos.com/07c98f2ca5cadce8c4c3ad4ffcf7980e5e209522.jpg?x-bce-process=image%2Fresize%2Cm_lfit%2Cw_500%2Climit_1%2Fquality%2Cq_80" alt="Word如何调整文字宽度"></p></li><li><p>有些朋友在操作时会出现图示状况，原因是选取设置的内容时，需要按住CTRL键选择不连续文本，而不能直接选取整个内容。</p><p><img src="https://exp-picture.cdn.bcebos.com/76b6860e5f20437105509b93323acd8921c58f22.jpg?x-bce-process=image%2Fresize%2Cm_lfit%2Cw_500%2Climit_1%2Fquality%2Cq_80" alt="Word如何调整文字宽度"></p></li><li><p>你可以将其他部分单个选取设置宽度，也可以按住CTRL键选取后全部设置，达到预期效果。</p><p><img src="images/Untitled/274e9635dd8a59de268c25b2b370d5413b8c8422.jpg" alt="Word如何调整文字宽度"></p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;ol&gt;
&lt;li&gt;&lt;p&gt;打开文档，我们发现内容参差不齐：
    
    </summary>
    
    
      <category term="office" scheme="https://blog.songuo.tech/categories/office/"/>
    
    
      <category term="office" scheme="https://blog.songuo.tech/tags/office/"/>
    
  </entry>
  
  <entry>
    <title>WEB套打程序开发 (lodop使用)</title>
    <link href="https://blog.songuo.tech/p/27db05d5.html"/>
    <id>https://blog.songuo.tech/p/27db05d5.html</id>
    <published>2021-05-12T07:30:00.000Z</published>
    <updated>2021-05-12T08:46:42.546Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.diewufeiyang.com/post/1210.html" target="_blank" rel="noopener">WEB套打程序开发 (lodop使用)</a></p><p>WEB套打可选方案不多，理想的更少，利用免费控件Lodop+JavaScript实现精确套打，算是较为经典的选择。这种方案其实比较简单，利用一个htm文件就可以实现模板设计过程，几乎是“空手套”式的开发，但理解这几个步骤还是需要点时间，下面一步步详细演示说明：<a id="more"></a></p><p>第一步：建立一个空白的模板设计文件</p><p>把以下超文本代码复制到一个本地htm文件中:</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210512/0025zsLrzy6GWjHaJkK3a-1.jpg" alt="img"></p><p>本文模拟EMS特快专递单的程序开发，文件起名为printEMS.htm，权且称它为模板设计文件。</p><p>第二步：用浏览器打开该文件</p><p>在本地文件夹中双击该文件就可以打开，但在进入设计之前，你的机器需要安装Lodop，如果还没安装过，</p><p>请在如下地址下载安装文件(解压rar后运行那个exe文件，Lodop是一个1M左右的小文件)：</p><p><a href="http://www.lodop.net/download.html" target="_blank" rel="noopener">http://www.lodop.net/download.html</a></p><p>第三步：准备设计</p><p>成功安装Lodop之后再次打开模板设计文件printEMS.htm，点击其中“模板设计”链接，就弹出如下空白的打印设计窗口：</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210512/0025zsLrzy6GWjHaJkK3a-2.jpg" alt="img"></p><p>为了尽快定位模板中的数据位置，你需要做一张票据扫描图作为背景，当然没有扫描图也能完成，只是需要多摸索几次，费点时间而已。</p><p>下面是我做的EMS扫描图，你把该图另存成一个jpg文件，以便我们一起完成后面的演示步骤。</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210512/0025zsLrzy6GWjHaJkK3a-3.jpg" alt="img"></p><p>第四步：装载背景图并调整图片大小</p><p>在打印设计窗口，点下图所示的“装载背景图…”菜单，调入以上保存的EMS图片文件。</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210512/0025zsLrzy6GWjHaJkK3a-4.jpg" alt="img"></p><p>装载背景图后，点上图所示的“调整背景图…”菜单，弹出下图“背景图调整”窗口，设定其中的图片宽度为209mm,高度113mm会自动变化。</p><p>这个宽度值是我测量实际票据得来的。如果扫描图是按1:1比例获得的，那么调整背景图这一步就免了，当然要做点这点很难，所以最好还是在这里直接设置具体尺寸反倒简单。</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210512/0025zsLrzy6GWjHaJkK3a-5.jpg" alt="img"></p><p>第五步：添加数据内容，开始打印测试</p><p>点下图所示“插入文本项”菜单，添加打印内容，内容项可以拖拉或精细调整，基本对准之后，点击“预览”按钮（注意旁边的“打印”按钮是收费功能，纸上会有水印，而“预览时的打印”按钮是完全免费的，我们用后者）。</p><p>把内容打印到薄一点的白纸上，然后在阳光下与真实票据透亮对比，以最左最上的某个内容为基准，其它内容远近调整，如此反复测试直到所有内容相互位置都对准。</p><p>这一步先做到内容之间的相互位置对准，等下一步处理整体位置。</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210512/0025zsLrzy6GWjHaJkK3a-6.jpg" alt="img"></p><p>第六步：整体对准</p><p>由于打印机左边距或上边距不一定是零或票据边缘有误差，所以尽管第五步打印出来的内容相互之间位置是准确的，但打印到真实票据上仍会整体偏离一些，需要进行整体位置调整。</p><p>点击下图红圈所示的“纸钉”按钮，“纸钉”弹起后，整个设计版面就可以上下左右调整了，然后按上一步的办法打印测试，直到整体对准成功。为了避免浪费票据，打印时仍可用薄白纸测试，注意此时透光对照时，纸张的左边沿和上边沿要与票据对齐，通过观察内容的位置来判断是否整体对准。</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210512/0025zsLrzy6GWjHaJkK3a-7.jpg" alt="img"></p><p>第七步：生成打印模板的程序代码</p><p>套打测试成功后，点击第五步图中所示的“生成程序代码”菜单，出现下图结果，这些代码就是我们需要的模板程序代码，把他们复制出来，准备融合到你的页面程序中使用。</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210512/0025zsLrzy6GWjHaJkK3a-8.jpg" alt="img"></p><p>第八步：完成打印模板设计文件</p><p>想不想知道WEB套打有啥感觉？好，我们先做一个静态WEB页面爽一下：把第七步生成的程序代码，</p><p>插入替换第一步的空白设计文件CreatePrintPage函数内，变成如下内容:</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210512/0025zsLrzy6GWjHaJkK3a-9.jpg" alt="img"></p><p>把以上内容复制到另外一个htm文件printEMS_OK.htm中，双击打开它，点其中的打印预览，就可以实现简单的WEB套打了。</p><p>以上八步基本完成了模板设计，并实现静态页面套打，但要把模板代码融合到实际的WEB程序中，还需要做些工作。</p><p>第九步：模板程序代码的使用</p><p>把以上CreatePrintPage函数进行简单改造，原函数如下：</p><p>Java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">CreatePrintPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     LODOP.PRINT_INITA(<span class="number">14</span>,<span class="number">11</span>,<span class="number">800</span>,<span class="number">600</span>,<span class="string">"套打EMS的模板"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">95</span>,<span class="number">95</span>,<span class="number">75</span>,<span class="number">20</span>,<span class="string">"寄件人姓名"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">123</span>,<span class="number">148</span>,<span class="number">194</span>,<span class="number">20</span>,<span class="string">"寄件人单位名称"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">158</span>,<span class="number">101</span>,<span class="number">238</span>,<span class="number">35</span>,<span class="string">"寄件人的详细地址"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">92</span>,<span class="number">446</span>,<span class="number">75</span>,<span class="number">20</span>,<span class="string">"收件人姓名"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">122</span>,<span class="number">496</span>,<span class="number">208</span>,<span class="number">20</span>,<span class="string">"收件人单位名称"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">160</span>,<span class="number">460</span>,<span class="number">244</span>,<span class="number">35</span>,<span class="string">"收件人详细地址"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">289</span>,<span class="number">47</span>,<span class="number">178</span>,<span class="number">22</span>,<span class="string">"内件品名"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">290</span>,<span class="number">258</span>,<span class="number">100</span>,<span class="number">20</span>,<span class="string">"内件数量"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">92</span>,<span class="number">245</span>,<span class="number">100</span>,<span class="number">20</span>,<span class="string">"寄件人电话"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">90</span>,<span class="number">608</span>,<span class="number">75</span>,<span class="number">20</span>,<span class="string">"收件人电话"</span>);</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure><p>把其中的打印内容提出来做为变量参数，函数改成如下样式：</p><p>Java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">CreatePrintPage</span><span class="params">(strPName,strJJRXM,strJJRDW,strJJRDZ,strSJRXM,strSJRDW,strSJRDZ,strNJPM,strNJSL,strJJRDH,strSJRDH)</span> </span>&#123;</span><br><span class="line">    LODOP.PRINT_INITA(<span class="number">14</span>,<span class="number">11</span>,<span class="number">800</span>,<span class="number">600</span>,strPName);        <span class="comment">//打印任务名</span></span><br><span class="line">    LODOP.ADD_PRINT_TEXT(<span class="number">95</span>,<span class="number">95</span>,<span class="number">75</span>,<span class="number">20</span>,strJJRXM);       <span class="comment">//寄件人姓名</span></span><br><span class="line">    LODOP.ADD_PRINT_TEXT(<span class="number">123</span>,<span class="number">148</span>,<span class="number">194</span>,<span class="number">20</span>,strJJRDW);    <span class="comment">//寄件人单位名称</span></span><br><span class="line">    LODOP.ADD_PRINT_TEXT(<span class="number">158</span>,<span class="number">101</span>,<span class="number">238</span>,<span class="number">35</span>,strJJRDZ);    <span class="comment">//寄件人的详细地址</span></span><br><span class="line">    LODOP.ADD_PRINT_TEXT(<span class="number">92</span>,<span class="number">446</span>,<span class="number">75</span>,<span class="number">20</span>,strSJRXM);      <span class="comment">//收件人姓名</span></span><br><span class="line">    LODOP.ADD_PRINT_TEXT(<span class="number">122</span>,<span class="number">496</span>,<span class="number">208</span>,<span class="number">20</span>,strSJRDW);    <span class="comment">//收件人单位名称</span></span><br><span class="line">    LODOP.ADD_PRINT_TEXT(<span class="number">160</span>,<span class="number">460</span>,<span class="number">244</span>,<span class="number">35</span>,strSJRDZ);    <span class="comment">//收件人详细地址</span></span><br><span class="line">    LODOP.ADD_PRINT_TEXT(<span class="number">289</span>,<span class="number">47</span>,<span class="number">178</span>,<span class="number">22</span>,strNJPM);      <span class="comment">//内件品名</span></span><br><span class="line">    LODOP.ADD_PRINT_TEXT(<span class="number">290</span>,<span class="number">258</span>,<span class="number">100</span>,<span class="number">20</span>,strNJSL);     <span class="comment">//内件数量</span></span><br><span class="line">    LODOP.ADD_PRINT_TEXT(<span class="number">92</span>,<span class="number">245</span>,<span class="number">100</span>,<span class="number">20</span>,strJJRDH);     <span class="comment">//寄件人电话</span></span><br><span class="line">    LODOP.ADD_PRINT_TEXT(<span class="number">90</span>,<span class="number">608</span>,<span class="number">75</span>,<span class="number">20</span>,strSJRDH);      <span class="comment">//收件人电话</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这个改造后的JS函数还是很好理解的，无论写入js文件还是直接嵌在页面内都简单易用。</p><p>如果你改变了内容的字体、大小、粗斜体等格式，代码还会多一些，但总体来说比较简洁。</p><p>第十步：设置纸张高度，实现连续套打</p><p>多数套打业务的票据是连续纸，需要精确地分页，从而保证连续多页打印不偏移，</p><p>为此以上代码还要在PRINT_INITA之后加一行SET_PRINT_PAGESIZE语句：</p><p>Java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">CreatePrintPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     LODOP.PRINT_INITA(<span class="number">14</span>,<span class="number">11</span>,<span class="number">800</span>,<span class="number">600</span>,<span class="string">"套打EMS的模板"</span>);</span><br><span class="line">     LODOP.SET_PRINT_PAGESIZE(<span class="number">1</span>,<span class="string">"209mm"</span>,<span class="string">"113mm"</span>,<span class="string">""</span>);<span class="comment">//设置纸张高度</span></span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">95</span>,<span class="number">95</span>,<span class="number">75</span>,<span class="number">20</span>,<span class="string">"寄件人姓名"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">123</span>,<span class="number">148</span>,<span class="number">194</span>,<span class="number">20</span>,<span class="string">"寄件人单位名称"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">158</span>,<span class="number">101</span>,<span class="number">238</span>,<span class="number">35</span>,<span class="string">"寄件人的详细地址"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">92</span>,<span class="number">446</span>,<span class="number">75</span>,<span class="number">20</span>,<span class="string">"收件人姓名"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">122</span>,<span class="number">496</span>,<span class="number">208</span>,<span class="number">20</span>,<span class="string">"收件人单位名称"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">160</span>,<span class="number">460</span>,<span class="number">244</span>,<span class="number">35</span>,<span class="string">"收件人详细地址"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">289</span>,<span class="number">47</span>,<span class="number">178</span>,<span class="number">22</span>,<span class="string">"内件品名"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">290</span>,<span class="number">258</span>,<span class="number">100</span>,<span class="number">20</span>,<span class="string">"内件数量"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">92</span>,<span class="number">245</span>,<span class="number">100</span>,<span class="number">20</span>,<span class="string">"寄件人电话"</span>);</span><br><span class="line">     LODOP.ADD_PRINT_TEXT(<span class="number">90</span>,<span class="number">608</span>,<span class="number">75</span>,<span class="number">20</span>,<span class="string">"收件人电话"</span>);</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure><p>其中209mm这个纸宽参数意义不大，主要是113mm这个高度参数，它决定了每页的走纸距离，对连续打印影响很大。这个值是我测量实际票据高度得来的，包含纸张之间的撕孔间隙。理想的测量方式，是若干页连起来一起测量取其平均高。</p><p>加入纸高控制后的打印预览如下，你可以连续打印两页内容到同一张长一点的白纸上，测试对照一下看看。把以上加入SET_PRINT_PAGESIZE语句的代码复制进第三个htm文件printEMS_OKM.htm试试。假如从第二页开始，内容向下偏移，说明纸张高度设置比实际票据大，就减小113mm这个参数值，否则增大它，这个参数可以精确到0.1mm。</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210512/0025zsLrzy6GWjHaJkK3a-10.jpg" alt="img"></p><p>第十一步：让操作者自己调整位置</p><p>以上十步实现的套打可以很精确，但都是以当前打印机为前提。如果你的打印程序要面对许多种类型的打印机，甚至一些未知的打印机类型，那么“打印维护”功能会很有用处。你可以根据情况在程序中把该功能授权给最终操作者或现场技术维护人员，让使用者自己来调整打印位置，以适应各种类型的打印机。</p><p>打印维护的指令语句是PRINT_SETUP，进入包含该功能的在线文件PrintEMS_OKMSetup.htm,先在打印维护中调整一下打印内容或整体位置，点“应用”按钮。关闭浏览器后重新打开，进入“打印预览”，看看是否有关联变化。下图是打印维护界面，其中能看到“应用”按钮和“恢复整体缺省”按钮的位置。</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210512/0025zsLrzy6GWjHaJkK3a-11.jpg" alt="img"></p><p>注意： 如果你在电脑对打印纸张已经进行了设置，就不需要在程序中设置纸张大小，如下面两句:LODOP.PRINT_INITA(14,11,800,600,”套打EMS的模板”);LODOP.SET_PRINT_PAGESIZE(1,”209mm”,”113mm”,””);//设置纸张高度；如果你两边都进行设置就会出现打印纸张不符合的问题，打印机会出现检查错误，从而打印不了，具体设置根据你测试情况而定</p><p>本文参考如下资料：</p><p><a href="http://www.lodop.net/demo.html" target="_blank" rel="noopener">http://www.lodop.net/demo.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://www.diewufeiyang.com/post/1210.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;WEB套打程序开发 (lodop使用)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;WEB套打可选方案不多，理想的更少，利用免费控件Lodop+JavaScript实现精确套打，算是较为经典的选择。这种方案其实比较简单，利用一个htm文件就可以实现模板设计过程，几乎是“空手套”式的开发，但理解这几个步骤还是需要点时间，下面一步步详细演示说明：
    
    </summary>
    
    
      <category term="开发经验" scheme="https://blog.songuo.tech/categories/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="lodop" scheme="https://blog.songuo.tech/tags/lodop/"/>
    
  </entry>
  
  <entry>
    <title>java利用Freemarker模板生成docx格式的word文档</title>
    <link href="https://blog.songuo.tech/p/3c425087.html"/>
    <id>https://blog.songuo.tech/p/3c425087.html</id>
    <published>2021-05-07T08:30:00.000Z</published>
    <updated>2021-05-07T09:49:29.611Z</updated>
    
    <content type="html"><![CDATA[<p>利用Freemarker模板生成docx<a id="more"></a></p><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>1.把docx文档修改为ZIP格式（修改.docx后缀名为.zip）<br>2.获取zip里的document.xml文档以及_rels文件夹下的document.xml.rels文档<br>3.把内容填充到document.xml里<br>4.在输入docx文档的时候把填充过内容的的 document.xml用流的方式写入zip（详见下面代码）。<br>5.输出docx文档<br>docx模板修改成zip格式后的信息如下（因为word文档本身就是ZIP格式实现的）</p><ul><li>document.xml里存放主要数据</li></ul><h2 id="处理流程"><a href="#处理流程" class="headerlink" title="处理流程"></a>处理流程</h2><p>1.准备好docx模板</p><p>2.把docx文档修改为ZIP格式（修改.docx后缀名为.zip）</p><p>3.获取zip文件里的word文件夹下的document.xml文件作为模板。</p><p>4.填充模板信息。</p><p>5.输出word测试</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.freemarker<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.31<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.io.FileUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.io.IoUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.extra.template.Template;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.extra.template.TemplateConfig;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.extra.template.TemplateEngine;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.extra.template.TemplateUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.text.WordUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.ZipEntry;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.ZipFile;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.ZipOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DocUtils</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        OutputStream outputStream = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            outputStream= <span class="keyword">new</span> FileOutputStream(<span class="string">"e:/test.docx"</span>);</span><br><span class="line">            Map dataMap = <span class="keyword">new</span> HashMap();</span><br><span class="line">            dataMap.put(<span class="string">"ah"</span>,<span class="string">"1231231"</span>);</span><br><span class="line">            dataMap.put(<span class="string">"dsrmc"</span>,<span class="string">"456"</span>);</span><br><span class="line">            createDocx(dataMap,outputStream);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//outputStream 输出流可以自己定义 浏览器或者文件输出流</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createDocx</span><span class="params">(Map dataMap, OutputStream outputStream)</span> </span>&#123;</span><br><span class="line">        ZipOutputStream zipout = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//内容模板</span></span><br><span class="line">            ByteArrayInputStream documentInput = getFreemarkerContentInputStream(dataMap);</span><br><span class="line">            <span class="comment">//最初设计的模板</span></span><br><span class="line">            File docxFile = <span class="keyword">new</span> File(<span class="string">"E:\\template.docx"</span>);</span><br><span class="line">            <span class="keyword">if</span> (!docxFile.exists()) &#123;</span><br><span class="line">                docxFile.createNewFile();</span><br><span class="line">            &#125;</span><br><span class="line">            ZipFile zipFile = <span class="keyword">new</span> ZipFile(docxFile);</span><br><span class="line">            Enumeration&lt;? extends ZipEntry&gt; zipEntrys = zipFile.entries();</span><br><span class="line">            zipout = <span class="keyword">new</span> ZipOutputStream(outputStream);</span><br><span class="line">            <span class="comment">//开始覆盖文档------------------</span></span><br><span class="line">            <span class="keyword">int</span> len = -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">while</span> (zipEntrys.hasMoreElements()) &#123;</span><br><span class="line">                ZipEntry next = zipEntrys.nextElement();</span><br><span class="line">                InputStream is = zipFile.getInputStream(next);</span><br><span class="line">                <span class="keyword">if</span> (next.toString().indexOf(<span class="string">"media"</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    zipout.putNextEntry(<span class="keyword">new</span> ZipEntry(next.getName()));</span><br><span class="line">                    <span class="comment">//如果是word/document.xml由我们输入</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">"word/document.xml"</span>.equals(next.getName())) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (documentInput != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            <span class="keyword">while</span> ((len = documentInput.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                                zipout.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">                            &#125;</span><br><span class="line">                            documentInput.close();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">while</span> ((len = is.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                            zipout.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">                        &#125;</span><br><span class="line">                        is.close();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"word导出失败:"</span>,e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(zipout!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    zipout.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    log.error(<span class="string">"io异常"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(outputStream!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    outputStream.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    log.error(<span class="string">"io异常"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取模板字符串输入流</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataMap   参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ByteArrayInputStream <span class="title">getFreemarkerContentInputStream</span><span class="params">(Map dataMap)</span> </span>&#123;</span><br><span class="line">        ByteArrayInputStream in = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TemplateEngine engine = TemplateUtil.createEngine(<span class="keyword">new</span> TemplateConfig());</span><br><span class="line">            String templateStr= FileUtil.readString(<span class="keyword">new</span> File(<span class="string">"E:\\document.xml"</span>),<span class="string">"utf-8"</span>);</span><br><span class="line">            Template template = engine.getTemplate(templateStr);</span><br><span class="line">            String result = template.render(dataMap);</span><br><span class="line">            <span class="comment">//这里一定要设置utf-8编码 否则导出的word中中文会是乱码</span></span><br><span class="line">            in = <span class="keyword">new</span> ByteArrayInputStream(result.getBytes(<span class="string">"utf-8"</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"模板生成错误！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> in;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;利用Freemarker模板生成docx
    
    </summary>
    
    
      <category term="开发经验" scheme="https://blog.songuo.tech/categories/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="word" scheme="https://blog.songuo.tech/tags/word/"/>
    
  </entry>
  
  <entry>
    <title>使用selenium 接管 已打开的浏览器</title>
    <link href="https://blog.songuo.tech/p/e522fa11.html"/>
    <id>https://blog.songuo.tech/p/e522fa11.html</id>
    <published>2021-04-12T05:22:00.000Z</published>
    <updated>2021-04-12T01:28:03.598Z</updated>
    
    <content type="html"><![CDATA[<p>在使用selenium进行自动化测试中我们有时会遇到这样的情况：</p><p>​    我们需要手动打开浏览器，进入到所需的页面，执行一些手动任务，如输入表单、输入验证码，登陆成功后，然后再开始运行自动化脚本。<a id="more"></a></p><p>这种情况下如何使用selenium来接管先前已打开的浏览器呢？</p><p>这里给出Google Chrome浏览器的解决方案。</p><p>我们可以利用Chrome DevTools协议。它允许客户检查和调试Chrome浏览器。</p><p>打开cmd，在命令行中输入命令：</p><p>chrome.exe —remote-debugging-port=9222 —user-data-dir=”C:\selenum\AutomationProfile”</p><p>   对于-remote-debugging-port值，可以指定任何打开的端口。</p><p>   对于-user-data-dir标记，指定创建新Chrome配置文件的目录。它是为了确保在单独的配置文件中启动chrome，不会污染你的默认配置文件。</p><p>   还有，不要忘了在环境变量中PATH里将chrome的路径添加进去。</p><p>此时会打开一个浏览器页面，我们输入百度网址，我们把它当成一个已存在的浏览器：</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210412/aHR0cHM6Ly9pbWcyMDE4LmNuYmxvZ3MuY29tL2Jsb2cvMTAwMTc1My8yMDE4MTAvMTAwMTc1My0yMDE4MTAxODIwNTIwMDgxNi0xNjQyMjYyOTY3LnBuZw.png" alt="img"></p><p>现在，我们需要接管上面的浏览器。新建一个python文件，运行以下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line">chrome_options = Options()</span><br><span class="line">chrome_options.add_experimental_option(<span class="string">"debuggerAddress"</span>, <span class="string">"127.0.0.1:9222"</span>)</span><br><span class="line">chrome_driver = <span class="string">"C:\Program Files (x86)\Google\Chrome\Application\chromedriver.exe"</span></span><br><span class="line">driver = webdriver.Chrome(chrome_driver, chrome_options=chrome_options)</span><br><span class="line">print(driver.title)</span><br></pre></td></tr></table></figure><p> 会发现打印出了 “百度一下，你就知道” 的网页标题。这样我们就实现了对一个已打开的浏览器的控制。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.tomcat.util.http.fileupload.IOUtils;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.By;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.WebDriver;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.WebElement;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.chrome.ChromeDriver;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.chrome.ChromeOptions;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.edge.EdgeDriver;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.ie.InternetExplorerDriver;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.interactions.Actions;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.support.ui.ExpectedCondition;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.support.ui.ExpectedConditions;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.support.ui.WebDriverWait;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMoveVerificationCode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String baseUrl = <span class="string">"http://tiaojie.court.gov.cn/fayuan"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        int port = NetUtils.getAvailablePort();</span></span><br><span class="line">        <span class="keyword">int</span> port = <span class="number">9224</span>;</span><br><span class="line">        System.out.println(<span class="string">"端口："</span>+port);</span><br><span class="line">        <span class="comment">//用户数据文件夹</span></span><br><span class="line">        String userDataDir=<span class="string">"C:\\selenum\\"</span>+port;</span><br><span class="line">        File dataDir = <span class="keyword">new</span> File(userDataDir);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//设置环境变量，将chrome.exe所在的文件夹C:\Program Files (x86)\Google\Chrome\Application\添加到path中</span></span><br><span class="line">            <span class="comment">// C:\Program Files (x86)\Google\Chrome\Application\chrome.exe --remote-debugging-port=9222 --user-data-dir="C:\selenum\AutomationProfile"</span></span><br><span class="line">            String cmd =<span class="string">"cmd /c start /MAX chrome.exe --remote-debugging-port="</span>+port+<span class="string">" --user-data-dir=\""</span>+userDataDir+<span class="string">"\""</span>;</span><br><span class="line">            Process process = Runtime.getRuntime().exec(cmd);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"浏览器已打开……"</span>);</span><br><span class="line"></span><br><span class="line">        System.setProperty(<span class="string">"webdriver.chrome.driver"</span>,<span class="string">"C:\\windows\\chromedriver.exe"</span>);</span><br><span class="line"></span><br><span class="line">        ChromeOptions options = <span class="keyword">new</span> ChromeOptions();</span><br><span class="line">        options.setExperimentalOption(<span class="string">"debuggerAddress"</span>, <span class="string">"127.0.0.1:"</span>+port);</span><br><span class="line"></span><br><span class="line">        WebDriver driver = <span class="keyword">new</span> ChromeDriver(options);</span><br><span class="line"></span><br><span class="line">        driver.get(baseUrl);</span><br><span class="line">        <span class="comment">//等待滑动验证码加载完成</span></span><br><span class="line">        <span class="keyword">new</span> WebDriverWait(driver, <span class="number">10</span>).until(ExpectedConditions.invisibilityOfElementLocated(By.xpath(<span class="string">"//span[contains(.,'加载中')]"</span>)));</span><br><span class="line">        <span class="comment">//等待元素出现</span></span><br><span class="line">        WebElement draggable = (<span class="keyword">new</span> WebDriverWait( driver, <span class="number">10</span>)).until(<span class="keyword">new</span> ExpectedCondition&lt;WebElement&gt;()&#123;</span><br><span class="line">                                                                        <span class="meta">@Override</span></span><br><span class="line">                                                                        <span class="function"><span class="keyword">public</span> WebElement <span class="title">apply</span><span class="params">(WebDriver d)</span></span>&#123;</span><br><span class="line">                                                                            <span class="keyword">return</span> d.findElement(By.className(<span class="string">"btn_slide"</span>));</span><br><span class="line">                                                                        &#125;</span><br><span class="line">                                                                    &#125;</span><br><span class="line">        );</span><br><span class="line">        WebElement userName = driver.findElement(By.id(<span class="string">"userName"</span>));</span><br><span class="line">        userName.sendKeys(<span class="string">"1111111"</span>);</span><br><span class="line">        WebElement password = driver.findElement(By.id(<span class="string">"password"</span>));</span><br><span class="line">        password.sendKeys(<span class="string">"12222"</span>);</span><br><span class="line"><span class="comment">//        WebElement draggable = driver.findElement(By.className("btn_slide"));</span></span><br><span class="line">        <span class="comment">// 声明action对象</span></span><br><span class="line">        Actions action = <span class="keyword">new</span> Actions(driver);</span><br><span class="line">        <span class="comment">// clickAndHold鼠标左键按下draggable元素不放</span></span><br><span class="line">        action.clickAndHold(draggable).build().perform();</span><br><span class="line">        <span class="comment">//确保每次拖动的像素不同，故而使用随机数。防止反爬虫拦截</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            action.moveByOffset((<span class="keyword">int</span>)(Math.random()*<span class="number">200</span>)+<span class="number">80</span>, <span class="number">0</span>);</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            action.moveByOffset((<span class="keyword">int</span>)(Math.random()*<span class="number">200</span>)+<span class="number">80</span>, <span class="number">0</span>);</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            action.moveByOffset((<span class="keyword">int</span>)(Math.random()*<span class="number">200</span>)+<span class="number">80</span>, <span class="number">0</span>);</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            action.moveByOffset((<span class="keyword">int</span>)(Math.random()*<span class="number">200</span>)+<span class="number">80</span>, <span class="number">0</span>);</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        action.moveByOffset(<span class="number">280</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">//释放</span></span><br><span class="line">        action.release();</span><br><span class="line">        <span class="comment">//执行</span></span><br><span class="line">        action.perform();</span><br><span class="line">        <span class="comment">//等待元素消失</span></span><br><span class="line"><span class="comment">//        new WebDriverWait(driver, 10).until(ExpectedConditions.invisibilityOfElementLocated(By.xpath("//span[contains(.,'加载中')]")));</span></span><br><span class="line">        WebElement loginBtn = driver.findElement(By.id(<span class="string">"loginBtn"</span>));</span><br><span class="line">        loginBtn.click();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试本机端口是否被使用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> port</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isLocalPortUsing</span><span class="params">(<span class="keyword">int</span> port)</span></span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//如果该端口还在使用则返回true,否则返回false,127.0.0.1代表本机</span></span><br><span class="line">            flag = isPortUsing(<span class="string">"127.0.0.1"</span>, port);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 测试主机Host的port端口是否被使用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> port</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isPortUsing</span><span class="params">(String host,<span class="keyword">int</span> port)</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InetAddress Address = InetAddress.getByName(host);</span><br><span class="line">            <span class="comment">//建立一个Socket连接</span></span><br><span class="line">            Socket socket = <span class="keyword">new</span> Socket(Address,port);</span><br><span class="line">            flag = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">//log.info(e.getMessage(),e);</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 由于本机上安装了mysql，采用3306端口去验证</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> testPost =<span class="number">3306</span>;</span><br><span class="line">        <span class="keyword">if</span>(isLocalPortUsing(testPost))&#123;</span><br><span class="line">            System.out.println(<span class="string">"端口 "</span>+testPost+<span class="string">" 已被使用"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"端口 "</span>+testPost+<span class="string">"未使用"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取可用端口</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getAvailablePort</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> max = <span class="number">65535</span>;</span><br><span class="line">        <span class="keyword">int</span> min = <span class="number">2000</span>;</span><br><span class="line"></span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">int</span> port = random.nextInt(max)%(max-min +<span class="number">1</span>) + min;</span><br><span class="line">        <span class="keyword">boolean</span> using = NetUtils.isLocalPortUsing(port);</span><br><span class="line">        <span class="keyword">if</span>(using)&#123;</span><br><span class="line">            <span class="keyword">return</span>  getAvailablePort();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span>  port;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在使用selenium进行自动化测试中我们有时会遇到这样的情况：&lt;/p&gt;
&lt;p&gt;​    我们需要手动打开浏览器，进入到所需的页面，执行一些手动任务，如输入表单、输入验证码，登陆成功后，然后再开始运行自动化脚本。
    
    </summary>
    
    
      <category term="selenium" scheme="https://blog.songuo.tech/categories/selenium/"/>
    
    
      <category term="selenium" scheme="https://blog.songuo.tech/tags/selenium/"/>
    
  </entry>
  
  <entry>
    <title>教你一招，让 Selenium 在 Linux 中以有头模式运行</title>
    <link href="https://blog.songuo.tech/p/48af776f.html"/>
    <id>https://blog.songuo.tech/p/48af776f.html</id>
    <published>2021-04-12T02:22:00.000Z</published>
    <updated>2021-04-12T01:23:25.093Z</updated>
    
    <content type="html"><![CDATA[<p>经常使用 Selenium 或者 Puppeteer 的同学都知道，启动的 Chrome 浏览器分为有头模式和无头模式</p><p>如果是有头模式，则会弹出一个 Chrome 浏览器窗口，然后你能看到这个浏览器里面在自动操作；而无头模式则不会弹出任何窗口，只有产生一个进程<a id="more"></a></p><p>下面这篇文章中，我们介绍了一个探测模拟浏览器特征的网站</p><p><a href="http://mp.weixin.qq.com/s?__biz=MzU1OTI0NjI1NQ==&amp;mid=2247487094&amp;idx=1&amp;sn=87a2e7e52b07f909a1e72aa1b91a3717&amp;chksm=fc1b70b6cb6cf9a0b88c90ebe62934b0fdccd8de8b50308bbcbb870fc1dec522b60db4770288&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">别去送死了！爬虫使用 Selenium 与 Puppeteer 能被网站探测的几十个特征</a></p><p>通过他我们可以发现，在不做任何设置的情况下，Selenium 或者 Puppeteer 启动的浏览器有几十个特征能够被目标网站识别为爬虫，并且无头模式的特征比有头模式的特征多得多</p><p>也就是说，即使你不使用任何隐藏特征的技术，仅仅使用有头模式，你都会安全很多；如果网站不是非常严格的反爬虫，很多情况下，使用无头模式更容易被发现，但使用有头模式，更难被发现</p><p>下图为使用 <strong>有头模式</strong>，不使用任何隐藏特征的技术访问检测网站：</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210412/96cdb561e80d4c1461af117caf62aabe.webp" alt="img"></p><p>下图为使用 <strong>无头模式</strong>，不使用任何隐藏特征的技术访问检测网站：</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210412/c78866a23b2fa8084385ac71dac09563.webp" alt="img">万里河山一片红</p><p>所以，一般情况下，你应该多使用有头模式</p><p>但问题在于，当我们要在 Linux 服务器上面使用 Selenium 或者 Puppeteer 运行爬虫的时候，就会发现有头模式始终会报错</p><p>这是因为，有头模式需要系统提供图形界面支持，才能绘制浏览器窗口，但是 Linux 服务器一般来说是没有图形界面的，所以有头模式一定会失败</p><p>在这种情况下，为了能够使用模拟浏览器的有头模式，我们需要搞一个假的图形界面出来，从而欺骗浏览器，让它的有头模式能够正常使用</p><p>为了达到这个目的，我们可以使用一个叫做 <code>Xvfb</code>的东西，这个东西在<strong>维基百科上面的介绍</strong>[1]如下：</p><blockquote><p>Xvfb or X virtual framebuffer is a display server implementing the X11 display server protocol. In contrast to other display servers, Xvfb performs all graphical operations in virtual memory without showing any screen output.</p></blockquote><p>Xvfb 在一个没有图像设备的机器上实现了 X11显示服务的协议，它实现了其他图形界面都有的各种接口，但并没有真正的图形界面</p><p>所以当一个程序在 Xvfb 中调用图形界面相关的操作时，这些操作都会在虚拟内存里面运行，只不过你什么都看不到而已</p><p>使用 Xvfb，我们就可以欺骗 Selenium 或者 Puppeteer，让它以为自己运行在一个有图形界面的系统里面，这样一来就能够正常使用有头模式了</p><p>要安装 Xvfb 非常简单，以 Ubuntu 为例，只需要执行下面两行命令就可以了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install xvfb</span><br></pre></td></tr></table></figure><p>现在，我们来写一段非常简单的 Selenium 操作 Chrome 的代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">from selenium.webdriver import Chrome</span><br><span class="line">driver &#x3D; Chrome(&#39;.&#x2F;chromedriver&#39;)</span><br><span class="line">driver.get(&#39;https:&#x2F;&#x2F;bot.sannysoft.com&#x2F;&#39;)</span><br><span class="line">time.sleep(5)</span><br><span class="line">driver.save_screenshot(&#39;screenshot.png&#39;)</span><br><span class="line">driver.close()</span><br><span class="line">print(&#39;运行完成&#39;)</span><br></pre></td></tr></table></figure><p>如果直接在服务器上运行，效果如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210412/3af1ffa5df2ca95749019ae507fc28ad.webp" alt="img"></p><p>由于 Linux 服务器原本没有图形界面，所以程序必定会报错</p><p>现在，我们只需要在运行这段代码的命令前面加上<code>xvfb-run</code>，再来看看运行效果：</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210412/3477ba8196dc91380fdfdb2ca54791d1.webp" alt="img"></p><p>代码成功运行，没有报错</p><p>现在我们从服务器上把这个生成的<code>screenshot.png</code>文件拉下来，打开以后可以看到内容如下：</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210412/46d70727e1108e70ae88481e3cb1a77e.webp" alt="img"></p><p>可以看到，虽然窗口比较小，但确实是有头模式下面的检测结果</p><p>当然，我们也可以调整一下窗口大小，增加参数：<code>xvfb-run python3 test.py -s -screen 0 1920x1080x16</code>就能假装在一个分辨率为 1920x1280 的显示器上运行程序了</p><p>然后修改 Selenium 的代码，设置浏览器窗口的大小：</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210412/c724d8b10a293a9ea1fc614767053e73.webp" alt="img"></p><p>运行效果如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/jooejooe/images/image/20210412/da15650d8e689291a6051275a9284bc4.webp" alt="img"></p><p>本文演示仅仅使用的是 Python操作 Selenium，同样你也可以试一试使用 Puppeteer，只需要把启动命令改为<code>xvfb-run node index.js</code> 即可！</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p>[1]维基百科上面的介绍: <em><a href="https://en.wikipedia.org/wiki/Xvfb" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Xvfb</a></em></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;经常使用 Selenium 或者 Puppeteer 的同学都知道，启动的 Chrome 浏览器分为有头模式和无头模式&lt;/p&gt;
&lt;p&gt;如果是有头模式，则会弹出一个 Chrome 浏览器窗口，然后你能看到这个浏览器里面在自动操作；而无头模式则不会弹出任何窗口，只有产生一个进程
    
    </summary>
    
    
      <category term="selenium" scheme="https://blog.songuo.tech/categories/selenium/"/>
    
    
      <category term="selenium" scheme="https://blog.songuo.tech/tags/selenium/"/>
    
  </entry>
  
</feed>
